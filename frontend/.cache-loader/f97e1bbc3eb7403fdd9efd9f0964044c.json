{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/packages/noobaa-storage-plugin/src/components/bucket-class/wizard-pages/backingstore-page.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/packages/noobaa-storage-plugin/src/components/bucket-class/wizard-pages/backingstore-page.tsx","mtime":1615298458680},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["import * as classNames from 'classnames';\nimport * as fuzzy from 'fuzzysearch';\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { Alert, AlertActionCloseButton, Button, Flex, FlexItem, Form, FormGroup, TextInput, Title, } from '@patternfly/react-core';\nimport { Table, TableBody, TableGridBreakpoint, TableHeader, TableVariant, } from '@patternfly/react-table';\nimport { Firehose, ResourceLink, ExternalLink, } from '@console/internal/components/utils';\nimport { referenceForModel } from '@console/internal/module/k8s';\nimport { NooBaaBackingStoreModel } from '@console/noobaa-storage-plugin/src/models';\nimport { PlusCircleIcon } from '@patternfly/react-icons';\nimport CreateBackingStoreFormModal from '../../create-backingstore-page/create-bs-modal';\nconst tableColumnClasses = [\n    classNames('col-md-4', 'col-sm-4', 'col-xs-6', 'nb-bc-bs-table__data'),\n    classNames('col-md-3', 'col-sm-4', 'col-xs-5', 'nb-bc-bs-table__data'),\n    classNames('col-md-2', 'col-sm-3', 'hidden-xs'),\n    classNames('col-md-2', 'hidden-sm', 'hidden-xs'),\n];\nconst nameMap = {\n    'aws-s3': 'awsS3',\n    'azure-blob': 'azureBlob',\n    'google-cloud-storage': 'googleCloudStorage',\n    's3-compatible': 's3Compatible',\n};\nconst columns = [\n    {\n        title: 'Name',\n        props: { className: tableColumnClasses[0] },\n    },\n    {\n        title: 'BucketName',\n        props: { className: tableColumnClasses[1] },\n    },\n    {\n        title: 'Type',\n        props: { className: tableColumnClasses[2] },\n    },\n    {\n        title: 'Region',\n        props: { className: tableColumnClasses[3] },\n    },\n];\nconst filterSelected = (list, tableId) => {\n    const sort = (x, y) => x.id.localeCompare(y.id);\n    return list.filter((e) => e.selectedBy === tableId || e.selectedBy === '').sort(sort);\n};\nconst getTableRows = (list) => {\n    return list.reduce((acc, bs) => {\n        const type = nameMap[_.get(bs, 'spec.type')];\n        const obj = {\n            selected: false,\n            id: bs.metadata.name,\n            selectedBy: '',\n            cells: [\n                {\n                    title: (React.createElement(ResourceLink, { kind: referenceForModel(NooBaaBackingStoreModel), namespace: bs.metadata.namespace, name: bs.metadata.name, title: bs.metadata.uid })),\n                },\n                {\n                    title: _.get(bs, ['spec', type, 'targetBucket'], '-'),\n                },\n                {\n                    title: type,\n                },\n                {\n                    title: _.get(bs, ['spec', type, 'region'], '-'),\n                },\n            ],\n        };\n        return [...acc, obj];\n    }, []);\n};\nconst filterSelectedItems = (items, tableId) => items.filter((e) => e.selectedBy === tableId).map((e) => e.id);\nconst getBsLabel = (policy) => policy === 'Mirror'\n    ? 'Select at least 2 Backing Store resources'\n    : 'Select at least 1 Backing Store resource';\nconst BackingStorePage = React.memo(({ backingStores, dispatcher, state }) => {\n    // CR data\n    const { data: backingStoreData } = backingStores;\n    // CR data clones to maintain order and selection state for table rows\n    const { backingStores: storeMain, namespace } = state;\n    const { tier2Policy } = state;\n    const showTier2Table = !!tier2Policy;\n    const [searchInput, setSearchInput] = React.useState('');\n    const [searchInput2, setSearchInput2] = React.useState('');\n    const [showHelp, setShowHelp] = React.useState(true);\n    const openModal = () => {\n        CreateBackingStoreFormModal({ namespace });\n    };\n    const filterSearch = (search, list) => {\n        if (!search)\n            return list;\n        return list.filter((elem) => fuzzy(search, elem.id));\n    };\n    React.useEffect(() => {\n        const stores = getTableRows(backingStoreData);\n        dispatcher({ type: 'setBackingStores', value: stores });\n        // eslint-disable-next-line\n    }, [JSON.stringify(backingStoreData), dispatcher]);\n    const onSelect = (isSelected, tableId, rowData) => {\n        const selectedItem = storeMain.find((elem) => elem.id === rowData.id);\n        const store = new Set(storeMain);\n        store.delete(selectedItem);\n        selectedItem.selected = !selectedItem.selected;\n        isSelected ? (selectedItem.selectedBy = tableId) : (selectedItem.selectedBy = '');\n        store.add(selectedItem);\n        dispatcher({ type: 'setBackingStores', value: [...store] });\n        // 0 tier-1 table, 1 tier-2 table\n        const itemsTable1 = filterSelectedItems(storeMain, 0);\n        dispatcher({ type: 'setBackingStoreTier1', value: itemsTable1 });\n        const itemsTable2 = filterSelectedItems(storeMain, 1);\n        dispatcher({ type: 'setBackingStoreTier2', value: itemsTable2 });\n    };\n    return (React.createElement(\"div\", { className: \"nb-create-bc-step-page\" },\n        showHelp && (React.createElement(Alert, { className: \"nb-create-bc-step-page__info\", isInline: true, variant: \"info\", title: \"What is a Backing Store?\", action: React.createElement(AlertActionCloseButton, { onClose: () => setShowHelp(false) }) },\n            React.createElement(\"p\", null, \"Backing Store represents a storage target to be used as the underlying storage for the data in MCG buckets.\"),\n            React.createElement(\"p\", null, \"Multiple types of backing-stores are supported: asws-s3, s3-compatible, google-cloud-storage, azure-blob, obc, PVC.\"),\n            React.createElement(ExternalLink, { href: \"https://github.com/noobaa/noobaa-operator/blob/master/doc/backing-store-crd.md\", text: \"Learn More\" }))),\n        React.createElement(Form, { className: \"nb-bc-step-page-form\" },\n            React.createElement(Title, { headingLevel: \"h3\", size: \"xl\", className: \"nb-bc-step-page-form__title\" },\n                React.createElement(Flex, { breakpointMods: [{ modifier: 'justify-content-space-between' }] },\n                    React.createElement(FlexItem, null,\n                        \"Tier 1 - Backing Store (\",\n                        state.tier1Policy,\n                        \")\"),\n                    React.createElement(FlexItem, null,\n                        React.createElement(Button, { variant: \"link\", onClick: openModal, className: \"nb-bc-step-page-form__modal-launcher\" },\n                            React.createElement(PlusCircleIcon, null),\n                            \" Create Backing Store\")))),\n            React.createElement(FormGroup, { className: \"nb-bc-step-page-form__element\", fieldId: \"bs-1\", label: getBsLabel(state.tier1Policy), isRequired: true },\n                React.createElement(TextInput, { className: \"nb-bc-step-page-form__element--short\", placeholder: \"Search Backing Store\", onChange: setSearchInput, value: searchInput, type: \"text\", \"aria-label\": \"Search Backing Store\" })),\n            React.createElement(Table, { onSelect: (event, isSelected, index, rowData) => onSelect(isSelected, 0, rowData), cells: columns, rows: filterSearch(searchInput, filterSelected(storeMain, 0)), variant: TableVariant.compact, gridBreakPoint: TableGridBreakpoint.none, \"aria-label\": \"Select Backing Store for Tier 1\", className: \"nb-bc-bs-page__table--short\", canSelectAll: false },\n                React.createElement(TableHeader, null),\n                React.createElement(TableBody, null)),\n            React.createElement(\"p\", { className: \"nb-create-bc-step-page-form__element--light-text\" },\n                state.tier1BackingStore.length,\n                \" resources selected\")),\n        showTier2Table && (React.createElement(Form, { className: \"nb-bc-step-page-form\" },\n            React.createElement(Title, { headingLevel: \"h3\", size: \"xl\" },\n                \"Tier 2 - Backing Store (\",\n                state.tier2Policy,\n                \")\",\n                ' '),\n            React.createElement(FormGroup, { className: \"nb-bc-step-page-form__element\", fieldId: \"bs-1\", label: getBsLabel(state.tier2Policy), isRequired: true },\n                React.createElement(TextInput, { className: \"nb-bc-step-page-form__element--short\", placeholder: \"Search Backing Store\", onChange: (v) => setSearchInput2(v), value: searchInput2, type: \"text\", \"aria-label\": \"Search Backing Store\" })),\n            React.createElement(Table, { \"aria-label\": \"Select Backing Store for Tier 2\", onSelect: (event, isSelected, index, rowData) => onSelect(isSelected, 1, rowData), cells: columns, rows: filterSearch(searchInput2, filterSelected(storeMain, 1)), variant: TableVariant.compact, gridBreakPoint: TableGridBreakpoint.none, className: \"nb-bc-bs-page__table--short\", canSelectAll: false },\n                React.createElement(TableHeader, null),\n                React.createElement(TableBody, null)),\n            React.createElement(\"p\", { className: \"nb-create-bc-step-page-form__element--light-text\" },\n                state.tier2BackingStore.length,\n                \" resources selected\")))));\n});\nconst BackingStorePageWithFirehose = (props) => {\n    const resource = [\n        {\n            kind: referenceForModel(NooBaaBackingStoreModel),\n            namespace: props.state.namespace,\n            prop: 'backingStores',\n            isList: true,\n        },\n    ];\n    return (React.createElement(Firehose, { resources: resource },\n        React.createElement(BackingStorePage, Object.assign({}, props))));\n};\nexport default BackingStorePageWithFirehose;\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/packages/noobaa-storage-plugin/src/components/bucket-class/wizard-pages/backingstore-page.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/packages/noobaa-storage-plugin/src/components/bucket-class/wizard-pages/backingstore-page.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as classNames from 'classnames';\nimport * as fuzzy from 'fuzzysearch';\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport {\n  Alert,\n  AlertActionCloseButton,\n  Button,\n  Flex,\n  FlexItem,\n  Form,\n  FormGroup,\n  TextInput,\n  Title,\n} from '@patternfly/react-core';\nimport {\n  IRowData,\n  Table,\n  TableBody,\n  TableGridBreakpoint,\n  TableHeader,\n  TableVariant,\n} from '@patternfly/react-table';\nimport {\n  Firehose,\n  FirehoseResult,\n  ResourceLink,\n  ExternalLink,\n} from '@console/internal/components/utils';\nimport { K8sResourceKind, referenceForModel } from '@console/internal/module/k8s';\nimport { NooBaaBackingStoreModel } from '@console/noobaa-storage-plugin/src/models';\nimport { PlusCircleIcon } from '@patternfly/react-icons';\nimport { Action, BackingStoreStateType, State } from '../state';\nimport CreateBackingStoreFormModal from '../../create-backingstore-page/create-bs-modal';\n\nconst tableColumnClasses = [\n  classNames('col-md-4', 'col-sm-4', 'col-xs-6', 'nb-bc-bs-table__data'),\n  classNames('col-md-3', 'col-sm-4', 'col-xs-5', 'nb-bc-bs-table__data'),\n  classNames('col-md-2', 'col-sm-3', 'hidden-xs'),\n  classNames('col-md-2', 'hidden-sm', 'hidden-xs'),\n];\n\nconst nameMap = {\n  'aws-s3': 'awsS3',\n  'azure-blob': 'azureBlob',\n  'google-cloud-storage': 'googleCloudStorage',\n  's3-compatible': 's3Compatible',\n};\n\nconst columns = [\n  {\n    title: 'Name',\n    props: { className: tableColumnClasses[0] },\n  },\n  {\n    title: 'BucketName',\n    props: { className: tableColumnClasses[1] },\n  },\n  {\n    title: 'Type',\n    props: { className: tableColumnClasses[2] },\n  },\n  {\n    title: 'Region',\n    props: { className: tableColumnClasses[3] },\n  },\n];\n\nconst filterSelected = (list: BackingStoreStateType[], tableId: number) => {\n  const sort = (x, y) => x.id.localeCompare(y.id);\n  return list.filter((e) => e.selectedBy === tableId || e.selectedBy === '').sort(sort);\n};\n\nconst getTableRows = (list: K8sResourceKind[]) => {\n  return list.reduce((acc, bs) => {\n    const type: string = nameMap[_.get(bs, 'spec.type')];\n    const obj = {\n      selected: false,\n      id: bs.metadata.name,\n      selectedBy: '',\n      cells: [\n        {\n          title: (\n            <ResourceLink\n              kind={referenceForModel(NooBaaBackingStoreModel)}\n              namespace={bs.metadata.namespace}\n              name={bs.metadata.name}\n              title={bs.metadata.uid}\n            />\n          ),\n        },\n        {\n          title: _.get(bs, ['spec', type, 'targetBucket'], '-'),\n        },\n        {\n          title: type,\n        },\n        {\n          title: _.get(bs, ['spec', type, 'region'], '-'),\n        },\n      ],\n    };\n    return [...acc, obj];\n  }, []);\n};\n\nconst filterSelectedItems = (items: BackingStoreStateType[], tableId: number): string[] =>\n  items.filter((e) => e.selectedBy === tableId).map((e) => e.id);\n\nconst getBsLabel = (policy: string) =>\n  policy === 'Mirror'\n    ? 'Select at least 2 Backing Store resources'\n    : 'Select at least 1 Backing Store resource';\n\nconst BackingStorePage: React.FC<BackingStorePageProps> = React.memo(\n  ({ backingStores, dispatcher, state }) => {\n    // CR data\n    const { data: backingStoreData } = backingStores;\n    // CR data clones to maintain order and selection state for table rows\n    const { backingStores: storeMain, namespace } = state;\n    const { tier2Policy } = state;\n    const showTier2Table = !!tier2Policy;\n    const [searchInput, setSearchInput] = React.useState('');\n    const [searchInput2, setSearchInput2] = React.useState('');\n    const [showHelp, setShowHelp] = React.useState(true);\n\n    const openModal = () => {\n      CreateBackingStoreFormModal({ namespace });\n    };\n\n    const filterSearch = (search: string, list: BackingStoreStateType[]) => {\n      if (!search) return list;\n      return list.filter((elem) => fuzzy(search, elem.id));\n    };\n\n    React.useEffect(() => {\n      const stores = getTableRows(backingStoreData);\n      dispatcher({ type: 'setBackingStores', value: stores });\n      // eslint-disable-next-line\n    }, [JSON.stringify(backingStoreData), dispatcher]);\n\n    const onSelect = (isSelected: boolean, tableId: number, rowData: IRowData) => {\n      const selectedItem = storeMain.find((elem) => elem.id === rowData.id);\n      const store = new Set(storeMain);\n      store.delete(selectedItem);\n      selectedItem.selected = !selectedItem.selected;\n      isSelected ? (selectedItem.selectedBy = tableId) : (selectedItem.selectedBy = '');\n      store.add(selectedItem);\n      dispatcher({ type: 'setBackingStores', value: [...store] });\n      // 0 tier-1 table, 1 tier-2 table\n      const itemsTable1 = filterSelectedItems(storeMain, 0);\n      dispatcher({ type: 'setBackingStoreTier1', value: itemsTable1 });\n      const itemsTable2 = filterSelectedItems(storeMain, 1);\n      dispatcher({ type: 'setBackingStoreTier2', value: itemsTable2 });\n    };\n\n    return (\n      <div className=\"nb-create-bc-step-page\">\n        {showHelp && (\n          <Alert\n            className=\"nb-create-bc-step-page__info\"\n            isInline\n            variant=\"info\"\n            title=\"What is a Backing Store?\"\n            action={<AlertActionCloseButton onClose={() => setShowHelp(false)} />}\n          >\n            <p>\n              Backing Store represents a storage target to be used as the underlying storage for the\n              data in MCG buckets.\n            </p>\n            <p>\n              Multiple types of backing-stores are supported: asws-s3, s3-compatible,\n              google-cloud-storage, azure-blob, obc, PVC.\n            </p>\n            <ExternalLink\n              href=\"https://github.com/noobaa/noobaa-operator/blob/master/doc/backing-store-crd.md\"\n              text=\"Learn More\"\n            />\n          </Alert>\n        )}\n        <Form className=\"nb-bc-step-page-form\">\n          <Title headingLevel=\"h3\" size=\"xl\" className=\"nb-bc-step-page-form__title\">\n            <Flex breakpointMods={[{ modifier: 'justify-content-space-between' }] as any}>\n              <FlexItem>Tier 1 - Backing Store ({state.tier1Policy})</FlexItem>\n              <FlexItem>\n                <Button\n                  variant=\"link\"\n                  onClick={openModal}\n                  className=\"nb-bc-step-page-form__modal-launcher\"\n                >\n                  <PlusCircleIcon /> Create Backing Store\n                </Button>\n              </FlexItem>\n            </Flex>\n          </Title>\n\n          <FormGroup\n            className=\"nb-bc-step-page-form__element\"\n            fieldId=\"bs-1\"\n            label={getBsLabel(state.tier1Policy)}\n            isRequired\n          >\n            <TextInput\n              className=\"nb-bc-step-page-form__element--short\"\n              placeholder=\"Search Backing Store\"\n              onChange={setSearchInput}\n              value={searchInput}\n              type=\"text\"\n              aria-label=\"Search Backing Store\"\n            />\n          </FormGroup>\n          <Table\n            onSelect={(event, isSelected, index, rowData) => onSelect(isSelected, 0, rowData)}\n            cells={columns}\n            rows={filterSearch(searchInput, filterSelected(storeMain, 0))}\n            variant={TableVariant.compact}\n            gridBreakPoint={TableGridBreakpoint.none}\n            aria-label=\"Select Backing Store for Tier 1\"\n            className=\"nb-bc-bs-page__table--short\"\n            canSelectAll={false}\n          >\n            <TableHeader />\n            <TableBody />\n          </Table>\n          <p className=\"nb-create-bc-step-page-form__element--light-text\">\n            {state.tier1BackingStore.length} resources selected\n          </p>\n        </Form>\n        {showTier2Table && (\n          <Form className=\"nb-bc-step-page-form\">\n            <Title headingLevel=\"h3\" size=\"xl\">\n              Tier 2 - Backing Store ({state.tier2Policy}){' '}\n            </Title>\n            <FormGroup\n              className=\"nb-bc-step-page-form__element\"\n              fieldId=\"bs-1\"\n              label={getBsLabel(state.tier2Policy)}\n              isRequired\n            >\n              <TextInput\n                className=\"nb-bc-step-page-form__element--short\"\n                placeholder=\"Search Backing Store\"\n                onChange={(v) => setSearchInput2(v)}\n                value={searchInput2}\n                type=\"text\"\n                aria-label=\"Search Backing Store\"\n              />\n            </FormGroup>\n            <Table\n              aria-label=\"Select Backing Store for Tier 2\"\n              onSelect={(event, isSelected, index, rowData) => onSelect(isSelected, 1, rowData)}\n              cells={columns}\n              rows={filterSearch(searchInput2, filterSelected(storeMain, 1))}\n              variant={TableVariant.compact}\n              gridBreakPoint={TableGridBreakpoint.none}\n              className=\"nb-bc-bs-page__table--short\"\n              canSelectAll={false}\n            >\n              <TableHeader />\n              <TableBody />\n            </Table>\n            <p className=\"nb-create-bc-step-page-form__element--light-text\">\n              {state.tier2BackingStore.length} resources selected\n            </p>\n          </Form>\n        )}\n      </div>\n    );\n  },\n);\nconst BackingStorePageWithFirehose: React.FC<BackingStorePageWithFirehoseProps> = (props) => {\n  const resource = [\n    {\n      kind: referenceForModel(NooBaaBackingStoreModel),\n      namespace: props.state.namespace,\n      prop: 'backingStores',\n      isList: true,\n    },\n  ];\n  return (\n    <Firehose resources={resource}>\n      <BackingStorePage {...props} />\n    </Firehose>\n  );\n};\n\nexport default BackingStorePageWithFirehose;\n\ntype BackingStorePageProps = {\n  backingStores?: FirehoseResult<K8sResourceKind[]>;\n  dispatcher: React.Dispatch<Action>;\n  state: State;\n};\n\ntype BackingStorePageWithFirehoseProps = {\n  dispatcher: React.Dispatch<Action>;\n  state: State;\n};\n"]}]}