{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/import/ImportForm.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/import/ImportForm.tsx","mtime":1616735742380},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["import * as React from 'react';\nimport { Formik } from 'formik';\nimport * as _ from 'lodash';\nimport { history, AsyncComponent } from '@console/internal/components/utils';\nimport { getActivePerspective, getActiveApplication } from '@console/internal/reducers/ui';\nimport { connect } from 'react-redux';\nimport { ALL_APPLICATIONS_KEY } from '@console/shared';\nimport { normalizeBuilderImages } from '../../utils/imagestream-utils';\nimport { doContextualBinding, sanitizeApplicationValue } from '../../utils/application-utils';\nimport { ALLOW_SERVICE_BINDING } from '../../const';\nimport { Resources } from './import-types';\nimport { createOrUpdateResources, handleRedirect } from './import-submit-utils';\nimport { validationSchema } from './import-validation-utils';\nimport { healthChecksProbeInitialData } from '../health-checks/health-checks-probe-utils';\nconst ImportForm = ({ namespace, imageStreams, importData, contextualSource, perspective, activeApplication, projects, serviceBindingAvailable, }) => {\n    const initialValues = {\n        name: '',\n        project: {\n            name: namespace || '',\n            displayName: '',\n            description: '',\n        },\n        application: {\n            initial: sanitizeApplicationValue(activeApplication),\n            name: sanitizeApplicationValue(activeApplication),\n            selectedKey: activeApplication,\n        },\n        git: {\n            url: '',\n            type: '',\n            ref: '',\n            dir: '/',\n            showGitType: false,\n            secret: '',\n            isUrlValidating: false,\n        },\n        docker: {\n            dockerfilePath: 'Dockerfile',\n            containerPort: 8080,\n        },\n        image: {\n            selected: '',\n            recommended: '',\n            tag: '',\n            tagObj: {},\n            ports: [],\n            isRecommending: false,\n            couldNotRecommend: false,\n        },\n        route: {\n            disable: false,\n            create: true,\n            targetPort: '',\n            path: '',\n            hostname: '',\n            secure: false,\n            tls: {\n                termination: '',\n                insecureEdgeTerminationPolicy: '',\n                caCertificate: '',\n                certificate: '',\n                destinationCACertificate: '',\n                privateKey: '',\n            },\n        },\n        resources: Resources.Kubernetes,\n        resourceTypesNotValid: contextualSource ? [Resources.KnativeService] : [],\n        serverless: {\n            scaling: {\n                minpods: 0,\n                maxpods: '',\n                concurrencytarget: '',\n                concurrencylimit: '',\n            },\n        },\n        pipeline: {\n            enabled: false,\n        },\n        build: {\n            env: [],\n            triggers: {\n                webhook: true,\n                image: true,\n                config: true,\n            },\n            strategy: importData.buildStrategy || 'Source',\n        },\n        deployment: {\n            env: [],\n            triggers: {\n                image: true,\n                config: true,\n            },\n            replicas: 1,\n        },\n        labels: {},\n        limits: {\n            cpu: {\n                request: '',\n                requestUnit: 'm',\n                defaultRequestUnit: 'm',\n                limit: '',\n                limitUnit: 'm',\n                defaultLimitUnit: 'm',\n            },\n            memory: {\n                request: '',\n                requestUnit: 'Mi',\n                defaultRequestUnit: 'Mi',\n                limit: '',\n                limitUnit: 'Mi',\n                defaultLimitUnit: 'Mi',\n            },\n        },\n        healthChecks: healthChecksProbeInitialData,\n    };\n    const builderImages = imageStreams && imageStreams.loaded && normalizeBuilderImages(imageStreams.data);\n    const handleSubmit = (values, actions) => {\n        const imageStream = builderImages && builderImages[values.image.selected].obj;\n        const createNewProject = projects.loaded && _.isEmpty(projects.data);\n        const { project: { name: projectName }, } = values;\n        const resourceActions = createOrUpdateResources(values, imageStream, createNewProject, true).then(() => createOrUpdateResources(values, imageStream));\n        if (contextualSource) {\n            resourceActions\n                .then((resources) => doContextualBinding(resources, contextualSource, serviceBindingAvailable))\n                .catch(() => { });\n        }\n        resourceActions\n            .then(() => {\n            actions.setSubmitting(false);\n            handleRedirect(projectName, perspective);\n        })\n            .catch((err) => {\n            actions.setSubmitting(false);\n            actions.setStatus({ submitError: err.message });\n        });\n    };\n    const renderForm = (props) => {\n        return (React.createElement(AsyncComponent, Object.assign({}, props, { projects: projects, builderImages: builderImages, loader: importData.loader })));\n    };\n    return (React.createElement(Formik, { initialValues: initialValues, onSubmit: handleSubmit, onReset: history.goBack, validationSchema: validationSchema, render: renderForm }));\n};\nconst mapStateToProps = (state, ownProps) => {\n    const perspective = getActivePerspective(state);\n    const activeApplication = ownProps.forApplication || getActiveApplication(state);\n    return {\n        perspective,\n        activeApplication: activeApplication !== ALL_APPLICATIONS_KEY ? activeApplication : '',\n        serviceBindingAvailable: state.FLAGS.get(ALLOW_SERVICE_BINDING),\n    };\n};\nexport default connect(mapStateToProps)(ImportForm);\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/import/ImportForm.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/import/ImportForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Formik } from 'formik';\nimport * as _ from 'lodash';\nimport { history, AsyncComponent } from '@console/internal/components/utils';\nimport { getActivePerspective, getActiveApplication } from '@console/internal/reducers/ui';\nimport { RootState } from '@console/internal/redux';\nimport { connect } from 'react-redux';\nimport { ALL_APPLICATIONS_KEY } from '@console/shared';\nimport { NormalizedBuilderImages, normalizeBuilderImages } from '../../utils/imagestream-utils';\nimport { doContextualBinding, sanitizeApplicationValue } from '../../utils/application-utils';\nimport { ALLOW_SERVICE_BINDING } from '../../const';\nimport { GitImportFormData, FirehoseList, ImportData, Resources } from './import-types';\nimport { createOrUpdateResources, handleRedirect } from './import-submit-utils';\nimport { validationSchema } from './import-validation-utils';\nimport { healthChecksProbeInitialData } from '../health-checks/health-checks-probe-utils';\n\nexport interface ImportFormProps {\n  namespace: string;\n  importData: ImportData;\n  contextualSource?: string;\n  imageStreams?: FirehoseList;\n  projects?: {\n    loaded: boolean;\n    data: [];\n  };\n}\n\nexport interface StateProps {\n  perspective: string;\n  activeApplication: string;\n  serviceBindingAvailable: boolean;\n}\n\nconst ImportForm: React.FC<ImportFormProps & StateProps> = ({\n  namespace,\n  imageStreams,\n  importData,\n  contextualSource,\n  perspective,\n  activeApplication,\n  projects,\n  serviceBindingAvailable,\n}) => {\n  const initialValues: GitImportFormData = {\n    name: '',\n    project: {\n      name: namespace || '',\n      displayName: '',\n      description: '',\n    },\n    application: {\n      initial: sanitizeApplicationValue(activeApplication),\n      name: sanitizeApplicationValue(activeApplication),\n      selectedKey: activeApplication,\n    },\n    git: {\n      url: '',\n      type: '',\n      ref: '',\n      dir: '/',\n      showGitType: false,\n      secret: '',\n      isUrlValidating: false,\n    },\n    docker: {\n      dockerfilePath: 'Dockerfile',\n      containerPort: 8080,\n    },\n    image: {\n      selected: '',\n      recommended: '',\n      tag: '',\n      tagObj: {},\n      ports: [],\n      isRecommending: false,\n      couldNotRecommend: false,\n    },\n    route: {\n      disable: false,\n      create: true,\n      targetPort: '',\n      path: '',\n      hostname: '',\n      secure: false,\n      tls: {\n        termination: '',\n        insecureEdgeTerminationPolicy: '',\n        caCertificate: '',\n        certificate: '',\n        destinationCACertificate: '',\n        privateKey: '',\n      },\n    },\n    resources: Resources.Kubernetes,\n    resourceTypesNotValid: contextualSource ? [Resources.KnativeService] : [],\n    serverless: {\n      scaling: {\n        minpods: 0,\n        maxpods: '',\n        concurrencytarget: '',\n        concurrencylimit: '',\n      },\n    },\n    pipeline: {\n      enabled: false,\n    },\n    build: {\n      env: [],\n      triggers: {\n        webhook: true,\n        image: true,\n        config: true,\n      },\n      strategy: importData.buildStrategy || 'Source',\n    },\n    deployment: {\n      env: [],\n      triggers: {\n        image: true,\n        config: true,\n      },\n      replicas: 1,\n    },\n    labels: {},\n    limits: {\n      cpu: {\n        request: '',\n        requestUnit: 'm',\n        defaultRequestUnit: 'm',\n        limit: '',\n        limitUnit: 'm',\n        defaultLimitUnit: 'm',\n      },\n      memory: {\n        request: '',\n        requestUnit: 'Mi',\n        defaultRequestUnit: 'Mi',\n        limit: '',\n        limitUnit: 'Mi',\n        defaultLimitUnit: 'Mi',\n      },\n    },\n    healthChecks: healthChecksProbeInitialData,\n  };\n  const builderImages: NormalizedBuilderImages =\n    imageStreams && imageStreams.loaded && normalizeBuilderImages(imageStreams.data);\n\n  const handleSubmit = (values, actions) => {\n    const imageStream = builderImages && builderImages[values.image.selected].obj;\n    const createNewProject = projects.loaded && _.isEmpty(projects.data);\n    const {\n      project: { name: projectName },\n    } = values;\n\n    const resourceActions = createOrUpdateResources(\n      values,\n      imageStream,\n      createNewProject,\n      true,\n    ).then(() => createOrUpdateResources(values, imageStream));\n\n    if (contextualSource) {\n      resourceActions\n        .then((resources) =>\n          doContextualBinding(resources, contextualSource, serviceBindingAvailable),\n        )\n        .catch(() => {});\n    }\n\n    resourceActions\n      .then(() => {\n        actions.setSubmitting(false);\n        handleRedirect(projectName, perspective);\n      })\n      .catch((err) => {\n        actions.setSubmitting(false);\n        actions.setStatus({ submitError: err.message });\n      });\n  };\n\n  const renderForm = (props) => {\n    return (\n      <AsyncComponent\n        {...props}\n        projects={projects}\n        builderImages={builderImages}\n        loader={importData.loader}\n      />\n    );\n  };\n\n  return (\n    <Formik\n      initialValues={initialValues}\n      onSubmit={handleSubmit}\n      onReset={history.goBack}\n      validationSchema={validationSchema}\n      render={renderForm}\n    />\n  );\n};\n\ntype OwnProps = ImportFormProps & { forApplication?: string };\nconst mapStateToProps = (state: RootState, ownProps: OwnProps): StateProps => {\n  const perspective = getActivePerspective(state);\n  const activeApplication = ownProps.forApplication || getActiveApplication(state);\n  return {\n    perspective,\n    activeApplication: activeApplication !== ALL_APPLICATIONS_KEY ? activeApplication : '',\n    serviceBindingAvailable: state.FLAGS.get(ALLOW_SERVICE_BINDING),\n  };\n};\n\nexport default connect(mapStateToProps)(ImportForm);\n"]}]}