{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/packages/console-app/src/components/nodes/node-dashboard/UtilizationCard.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/packages/console-app/src/components/nodes/node-dashboard/UtilizationCard.tsx","mtime":1615701814890},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as React from 'react';\nimport { PopoverPosition } from '@patternfly/react-core';\nimport { useMetricDuration } from '@console/shared/src/components/dashboard/duration-hook';\nimport ConsumerPopover, { LimitsBody } from '@console/shared/src/components/dashboard/utilization-card/TopConsumerPopover';\nimport DashboardCard from '@console/shared/src/components/dashboard/dashboard-card/DashboardCard';\nimport DashboardCardHeader from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardHeader';\nimport DashboardCardTitle from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardTitle';\nimport UtilizationBody from '@console/shared/src/components/dashboard/utilization-card/UtilizationBody';\nimport { ByteDataTypes } from '@console/shared/src/graph-helper/data-utils';\nimport { getNodeAddresses } from '@console/shared/src/selectors/node';\nimport { PodModel, ProjectModel } from '@console/internal/models';\nimport { humanizeCpuCores, humanizeBinaryBytes, humanizeDecimalBytesPerSec, humanizeNumber, Dropdown } from '@console/internal/components/utils';\nimport { PrometheusUtilizationItem, PrometheusMultilineUtilizationItem } from '@console/internal/components/dashboard/dashboards-page/cluster-dashboard/utilization-card';\nimport { NodeQueries, getUtilizationQueries, getMultilineQueries, getTopConsumerQueries, getResourceQutoaQueries } from './queries';\nimport { NodeDashboardContext } from './NodeDashboardContext';\nimport { useTranslation } from 'react-i18next';\nconst getPodConsumers = (query, nodeName) => ({\n    query,\n    model: PodModel,\n    fieldSelector: `spec.nodeName=${nodeName}`,\n    metric: 'pod',\n});\nconst getProjectConsumers = (query) => ({\n    query,\n    model: ProjectModel,\n    metric: 'namespace',\n});\nexport const CPUPopover = (_a) => {\n    var { nodeName, nodeIp, current, title, position = PopoverPosition.top } = _a, rest = __rest(_a, [\"nodeName\", \"nodeIp\", \"current\", \"title\", \"position\"]);\n    const consumers = React.useMemo(() => {\n        const queries = getTopConsumerQueries(nodeIp);\n        return [getProjectConsumers(queries[NodeQueries.PROJECTS_BY_CPU]), getPodConsumers(queries[NodeQueries.PODS_BY_CPU], nodeName)];\n    }, [nodeIp, nodeName]);\n    return (React.createElement(ConsumerPopover, { current: title, title: \"CPU\", consumers: consumers, humanize: humanizeCpuCores, position: position },\n        React.createElement(LimitsBody, Object.assign({}, rest, { current: current }))));\n};\nexport const MemoryPopover = (_a) => {\n    var { nodeName, nodeIp, current, title, position = PopoverPosition.top } = _a, rest = __rest(_a, [\"nodeName\", \"nodeIp\", \"current\", \"title\", \"position\"]);\n    const consumers = React.useMemo(() => {\n        const queries = getTopConsumerQueries(nodeIp);\n        return [getProjectConsumers(queries[NodeQueries.PROJECTS_BY_MEMORY]), getPodConsumers(queries[NodeQueries.PODS_BY_MEMORY], nodeName)];\n    }, [nodeIp, nodeName]);\n    return (React.createElement(ConsumerPopover, { current: title, title: \"Memory\", consumers: consumers, humanize: humanizeBinaryBytes, position: position },\n        React.createElement(LimitsBody, Object.assign({}, rest, { current: current }))));\n};\nconst UtilizationCard = () => {\n    var _a;\n    const [timestamps, setTimestamps] = React.useState();\n    const [duration, setDuration] = useMetricDuration();\n    const { obj, setCPULimit, setMemoryLimit } = React.useContext(NodeDashboardContext);\n    const { t } = useTranslation();\n    const nodeName = obj.metadata.name;\n    const nodeIp = (_a = getNodeAddresses(obj).find(addr => addr.type === 'InternalIP')) === null || _a === void 0 ? void 0 : _a.address;\n    const [queries, multilineQueries, resourceQuotaQueries, consumers] = React.useMemo(() => {\n        const topConsumerQueries = getTopConsumerQueries(nodeIp);\n        return [\n            getUtilizationQueries(nodeName, nodeIp),\n            getMultilineQueries(nodeName, nodeIp),\n            getResourceQutoaQueries(nodeName),\n            [\n                [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_FILESYSTEM]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_FILESYSTEM], nodeName)],\n                [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_NETWORK_IN]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_NETWORK_IN], nodeName)],\n                [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_NETWORK_OUT]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_NETWORK_OUT], nodeName)],\n            ],\n        ];\n    }, [nodeIp, nodeName]);\n    const cpuPopover = React.useCallback((props) => React.createElement(CPUPopover, Object.assign({}, props, { title: props.current, nodeIp: nodeIp, nodeName: nodeName })), [nodeIp, nodeName]);\n    const memPopover = React.useCallback((props) => React.createElement(MemoryPopover, Object.assign({}, props, { title: props.current, nodeIp: nodeIp, nodeName: nodeName })), [nodeIp, nodeName]);\n    const filesystemPopover = React.useCallback(({ current }) => React.createElement(ConsumerPopover, { title: \"Filesystem\", current: current, consumers: consumers[0], humanize: humanizeBinaryBytes, position: PopoverPosition.top }), [consumers]);\n    const networkPopoverIn = React.useCallback(({ current }) => React.createElement(ConsumerPopover, { title: \"Network In\", current: current, consumers: consumers[1], humanize: humanizeDecimalBytesPerSec, position: PopoverPosition.top }), [consumers]);\n    const networkPopoverOut = React.useCallback(({ current }) => React.createElement(ConsumerPopover, { title: \"Network Out\", current: current, consumers: consumers[2], humanize: humanizeDecimalBytesPerSec, position: PopoverPosition.top }), [consumers]);\n    const networkPopovers = React.useMemo(() => [networkPopoverIn, networkPopoverOut], [networkPopoverIn, networkPopoverOut]);\n    let durationItems = {\n        ['ONE_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1'),\n        ['SIX_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1'),\n        ['TWENTY_FOUR_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1'),\n    };\n    let durationValues = {\n        [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1')]: '1 Hour',\n        [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1')]: '6 Hours',\n        [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1')]: '24 Hours',\n    };\n    React.useEffect(() => {\n        durationItems = {\n            ['ONE_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1'),\n            ['SIX_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1'),\n            ['TWENTY_FOUR_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1'),\n        };\n        durationValues = {\n            [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1')]: '1 Hour',\n            [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1')]: '6 Hours',\n            [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1')]: '24 Hours',\n        };\n    }, [duration]);\n    return (React.createElement(DashboardCard, { \"data-test-id\": \"utilization-card\" },\n        React.createElement(DashboardCardHeader, null,\n            React.createElement(DashboardCardTitle, null, \"Utilization\"),\n            React.createElement(Dropdown, { items: durationItems, onChange: setDuration, selectedKey: durationValues[duration], title: duration })),\n        React.createElement(UtilizationBody, { timestamps: timestamps },\n            React.createElement(PrometheusUtilizationItem, { title: t('COMMON:MSG_DETAILS_TABNODE_TABLEHEADER_3'), humanizeValue: humanizeCpuCores, utilizationQuery: queries[NodeQueries.CPU_USAGE], totalQuery: queries[NodeQueries.CPU_TOTAL], limitQuery: resourceQuotaQueries[NodeQueries.POD_RESOURCE_LIMIT_CPU], requestQuery: resourceQuotaQueries[NodeQueries.POD_RESOURCE_REQUEST_CPU], TopConsumerPopover: cpuPopover, duration: duration, setTimestamps: setTimestamps, setLimitReqState: setCPULimit }),\n            React.createElement(PrometheusUtilizationItem, { title: t('COMMON:MSG_DETAILS_TABNODE_TABLEHEADER_4'), humanizeValue: humanizeBinaryBytes, utilizationQuery: queries[NodeQueries.MEMORY_USAGE], totalQuery: queries[NodeQueries.MEMORY_TOTAL], limitQuery: resourceQuotaQueries[NodeQueries.POD_RESOURCE_LIMIT_MEMORY], requestQuery: resourceQuotaQueries[NodeQueries.POD_RESOURCE_REQUEST_MEMORY], byteDataType: ByteDataTypes.BinaryBytes, TopConsumerPopover: memPopover, duration: duration, setLimitReqState: setMemoryLimit }),\n            React.createElement(PrometheusUtilizationItem, { title: t('COMMON:MSG_DETAILS_TABDETAILS_DETAILS_81'), humanizeValue: humanizeBinaryBytes, utilizationQuery: queries[NodeQueries.FILESYSTEM_USAGE], totalQuery: queries[NodeQueries.FILESYSTEM_TOTAL], byteDataType: ByteDataTypes.BinaryBytes, TopConsumerPopover: filesystemPopover, duration: duration }),\n            React.createElement(PrometheusMultilineUtilizationItem, { title: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_NETWORK_1'), humanizeValue: humanizeDecimalBytesPerSec, queries: multilineQueries[NodeQueries.NETWORK_UTILIZATION], TopConsumerPopovers: networkPopovers, duration: duration }),\n            React.createElement(PrometheusUtilizationItem, { title: t('COMMON:MSG_DETAILS_TABDETAILS_DETAILS_78'), humanizeValue: humanizeNumber, utilizationQuery: queries[NodeQueries.POD_COUNT], duration: duration }))));\n};\nexport default UtilizationCard;\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/packages/console-app/src/components/nodes/node-dashboard/UtilizationCard.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/packages/console-app/src/components/nodes/node-dashboard/UtilizationCard.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { PopoverPosition } from '@patternfly/react-core';\nimport { useMetricDuration } from '@console/shared/src/components/dashboard/duration-hook';\nimport { TopConsumerPopoverProp } from '@console/shared/src/components/dashboard/utilization-card/UtilizationItem';\nimport ConsumerPopover, { LimitsBody } from '@console/shared/src/components/dashboard/utilization-card/TopConsumerPopover';\nimport DashboardCard from '@console/shared/src/components/dashboard/dashboard-card/DashboardCard';\nimport DashboardCardHeader from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardHeader';\nimport DashboardCardTitle from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardTitle';\nimport UtilizationBody from '@console/shared/src/components/dashboard/utilization-card/UtilizationBody';\nimport { ByteDataTypes } from '@console/shared/src/graph-helper/data-utils';\nimport { getNodeAddresses } from '@console/shared/src/selectors/node';\nimport { PodModel, ProjectModel } from '@console/internal/models';\nimport { humanizeCpuCores, humanizeBinaryBytes, humanizeDecimalBytesPerSec, humanizeNumber, Dropdown } from '@console/internal/components/utils';\nimport { PrometheusUtilizationItem, PrometheusMultilineUtilizationItem } from '@console/internal/components/dashboard/dashboards-page/cluster-dashboard/utilization-card';\n\nimport { NodeQueries, getUtilizationQueries, getMultilineQueries, getTopConsumerQueries, getResourceQutoaQueries } from './queries';\nimport { NodeDashboardContext } from './NodeDashboardContext';\nimport { useTranslation } from 'react-i18next';\nconst getPodConsumers = (query: string, nodeName: string) => ({\n  query,\n  model: PodModel,\n  fieldSelector: `spec.nodeName=${nodeName}`,\n  metric: 'pod',\n});\n\nconst getProjectConsumers = (query: string) => ({\n  query,\n  model: ProjectModel,\n  metric: 'namespace',\n});\n\nexport const CPUPopover: React.FC<PopoverProps> = ({ nodeName, nodeIp, current, title, position = PopoverPosition.top, ...rest }) => {\n  const consumers = React.useMemo(() => {\n    const queries = getTopConsumerQueries(nodeIp);\n    return [getProjectConsumers(queries[NodeQueries.PROJECTS_BY_CPU]), getPodConsumers(queries[NodeQueries.PODS_BY_CPU], nodeName)];\n  }, [nodeIp, nodeName]);\n  return (\n    <ConsumerPopover current={title} title=\"CPU\" consumers={consumers} humanize={humanizeCpuCores} position={position}>\n      <LimitsBody {...rest} current={current} />\n    </ConsumerPopover>\n  );\n};\n\nexport const MemoryPopover: React.FC<PopoverProps> = ({ nodeName, nodeIp, current, title, position = PopoverPosition.top, ...rest }) => {\n  const consumers = React.useMemo(() => {\n    const queries = getTopConsumerQueries(nodeIp);\n    return [getProjectConsumers(queries[NodeQueries.PROJECTS_BY_MEMORY]), getPodConsumers(queries[NodeQueries.PODS_BY_MEMORY], nodeName)];\n  }, [nodeIp, nodeName]);\n  return (\n    <ConsumerPopover current={title} title=\"Memory\" consumers={consumers} humanize={humanizeBinaryBytes} position={position}>\n      <LimitsBody {...rest} current={current} />\n    </ConsumerPopover>\n  );\n};\n\nconst UtilizationCard: React.FC = () => {\n  const [timestamps, setTimestamps] = React.useState<Date[]>();\n  const [duration, setDuration] = useMetricDuration();\n\n  const { obj, setCPULimit, setMemoryLimit } = React.useContext(NodeDashboardContext);\n  const { t } = useTranslation();\n  const nodeName = obj.metadata.name;\n  const nodeIp = getNodeAddresses(obj).find(addr => addr.type === 'InternalIP')?.address;\n  const [queries, multilineQueries, resourceQuotaQueries, consumers] = React.useMemo(() => {\n    const topConsumerQueries = getTopConsumerQueries(nodeIp);\n    return [\n      getUtilizationQueries(nodeName, nodeIp),\n      getMultilineQueries(nodeName, nodeIp),\n      getResourceQutoaQueries(nodeName),\n      [\n        [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_FILESYSTEM]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_FILESYSTEM], nodeName)],\n        [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_NETWORK_IN]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_NETWORK_IN], nodeName)],\n        [getProjectConsumers(topConsumerQueries[NodeQueries.PROJECTS_BY_NETWORK_OUT]), getPodConsumers(topConsumerQueries[NodeQueries.PODS_BY_NETWORK_OUT], nodeName)],\n      ],\n    ];\n  }, [nodeIp, nodeName]);\n\n  const cpuPopover = React.useCallback((props: TopConsumerPopoverProp) => <CPUPopover {...props} title={props.current} nodeIp={nodeIp} nodeName={nodeName} />, [nodeIp, nodeName]);\n\n  const memPopover = React.useCallback((props: TopConsumerPopoverProp) => <MemoryPopover {...props} title={props.current} nodeIp={nodeIp} nodeName={nodeName} />, [nodeIp, nodeName]);\n\n  const filesystemPopover = React.useCallback(({ current }: TopConsumerPopoverProp) => <ConsumerPopover title=\"Filesystem\" current={current} consumers={consumers[0]} humanize={humanizeBinaryBytes} position={PopoverPosition.top} />, [consumers]);\n\n  const networkPopoverIn = React.useCallback(({ current }: TopConsumerPopoverProp) => <ConsumerPopover title=\"Network In\" current={current} consumers={consumers[1]} humanize={humanizeDecimalBytesPerSec} position={PopoverPosition.top} />, [consumers]);\n\n  const networkPopoverOut = React.useCallback(({ current }: TopConsumerPopoverProp) => <ConsumerPopover title=\"Network Out\" current={current} consumers={consumers[2]} humanize={humanizeDecimalBytesPerSec} position={PopoverPosition.top} />, [consumers]);\n\n  const networkPopovers = React.useMemo(() => [networkPopoverIn, networkPopoverOut], [networkPopoverIn, networkPopoverOut]);\n\n  let durationItems = {\n    ['ONE_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1'),\n    ['SIX_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1'),\n    ['TWENTY_FOUR_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1'),\n  };\n\n  let durationValues = {\n    [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1')]: '1 Hour',\n    [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1')]: '6 Hours',\n    [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1')]: '24 Hours',\n  };\n\n  React.useEffect(() => {\n    durationItems = {\n      ['ONE_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1'),\n      ['SIX_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1'),\n      ['TWENTY_FOUR_HR']: t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1'),\n    };\n    durationValues = {\n      [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_1_1')]: '1 Hour',\n      [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_6_1')]: '6 Hours',\n      [t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_24_1')]: '24 Hours',\n    };\n  }, [duration]);\n\n  return (\n    <DashboardCard data-test-id=\"utilization-card\">\n      <DashboardCardHeader>\n        <DashboardCardTitle>Utilization</DashboardCardTitle>\n        <Dropdown items={durationItems} onChange={setDuration} selectedKey={durationValues[duration]} title={duration} />\n      </DashboardCardHeader>\n      <UtilizationBody timestamps={timestamps}>\n        <PrometheusUtilizationItem title={t('COMMON:MSG_DETAILS_TABNODE_TABLEHEADER_3')} humanizeValue={humanizeCpuCores} utilizationQuery={queries[NodeQueries.CPU_USAGE]} totalQuery={queries[NodeQueries.CPU_TOTAL]} limitQuery={resourceQuotaQueries[NodeQueries.POD_RESOURCE_LIMIT_CPU]} requestQuery={resourceQuotaQueries[NodeQueries.POD_RESOURCE_REQUEST_CPU]} TopConsumerPopover={cpuPopover} duration={duration} setTimestamps={setTimestamps} setLimitReqState={setCPULimit} />\n        <PrometheusUtilizationItem title={t('COMMON:MSG_DETAILS_TABNODE_TABLEHEADER_4')} humanizeValue={humanizeBinaryBytes} utilizationQuery={queries[NodeQueries.MEMORY_USAGE]} totalQuery={queries[NodeQueries.MEMORY_TOTAL]} limitQuery={resourceQuotaQueries[NodeQueries.POD_RESOURCE_LIMIT_MEMORY]} requestQuery={resourceQuotaQueries[NodeQueries.POD_RESOURCE_REQUEST_MEMORY]} byteDataType={ByteDataTypes.BinaryBytes} TopConsumerPopover={memPopover} duration={duration} setLimitReqState={setMemoryLimit} />\n        <PrometheusUtilizationItem title={t('COMMON:MSG_DETAILS_TABDETAILS_DETAILS_81')} humanizeValue={humanizeBinaryBytes} utilizationQuery={queries[NodeQueries.FILESYSTEM_USAGE]} totalQuery={queries[NodeQueries.FILESYSTEM_TOTAL]} byteDataType={ByteDataTypes.BinaryBytes} TopConsumerPopover={filesystemPopover} duration={duration} />\n        <PrometheusMultilineUtilizationItem title={t('SINGLE:MSG_OVERVIEW_MAIN_CARDCLUSTERUTILIZATION_NETWORK_1')} humanizeValue={humanizeDecimalBytesPerSec} queries={multilineQueries[NodeQueries.NETWORK_UTILIZATION]} TopConsumerPopovers={networkPopovers} duration={duration} />\n        <PrometheusUtilizationItem title={t('COMMON:MSG_DETAILS_TABDETAILS_DETAILS_78')} humanizeValue={humanizeNumber} utilizationQuery={queries[NodeQueries.POD_COUNT]} duration={duration} />\n      </UtilizationBody>\n    </DashboardCard>\n  );\n};\n\nexport default UtilizationCard;\n\nexport type PopoverProps = TopConsumerPopoverProp & {\n  nodeIp: string;\n  nodeName: string;\n  title: string;\n  position?: PopoverPosition;\n};\n"]}]}