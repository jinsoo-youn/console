{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/project-access/project-access-form-submit-utils.ts","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/project-access/project-access-form-submit-utils.ts","mtime":1615298458630},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["import * as _ from 'lodash';\nimport { k8sCreate, k8sKill, k8sPatch } from '@console/internal/module/k8s';\nimport { RoleBindingModel } from '@console/internal/models';\nimport { generateSecret } from '../import/import-submit-utils';\nimport { Verb } from './project-access-form-utils-types';\nexport const getRolesWithNameChange = (newRoles, removeRoles) => {\n    const createRoles = _.filter(newRoles, 'roleBindingName');\n    const deleteRoles = _.filter(removeRoles, (o1) => createRoles.find((o2) => o1.roleBindingName === o2.roleBindingName));\n    const rolesWithNameChange = _.filter(createRoles, (o1) => deleteRoles.find((o2) => o1.roleBindingName === o2.roleBindingName && o1.user !== o2.user && o1.role === o2.role));\n    return rolesWithNameChange;\n};\nexport const sendK8sRequest = (verb, roleBinding) => {\n    switch (verb) {\n        case Verb.Create:\n            return k8sCreate(RoleBindingModel, roleBinding);\n        case Verb.Remove:\n            return k8sKill(RoleBindingModel, roleBinding);\n        case Verb.Patch:\n            return k8sPatch(RoleBindingModel, { metadata: roleBinding.metadata }, [\n                { op: 'replace', path: `/subjects/0`, value: roleBinding.subjects[0] },\n            ]);\n        default:\n            return null;\n    }\n};\nexport const generateRoleBindingName = (username, role) => {\n    return `${username}-${role}-${generateSecret()}`;\n};\nexport const getNewRoles = (initialRoles, formValues) => {\n    const newRoles = _.uniqBy(_.filter(formValues, (o1) => !initialRoles.find((o2) => o1.user === o2.user && o1.role === o2.role)), function (user) {\n        return JSON.stringify([user.user, user.role]);\n    });\n    return newRoles;\n};\nexport const getRemovedRoles = (initialRoles, formValues) => {\n    const removeRoles = _.filter(initialRoles, (o1) => !formValues.find((o2) => o1.user === o2.user && o1.role === o2.role));\n    return removeRoles;\n};\nexport const sendRoleBindingRequest = (verb, roles, roleBinding) => {\n    const finalArray = [];\n    _.forEach(roles, (user) => {\n        const roleBindingName = verb === Verb.Create ? generateRoleBindingName(user.user, user.role) : user.roleBindingName;\n        roleBinding.subjects[0].name = user.user;\n        roleBinding.roleRef.name = user.role;\n        roleBinding.metadata.name = roleBindingName;\n        finalArray.push(sendK8sRequest(verb, roleBinding));\n    });\n    return finalArray;\n};\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/project-access/project-access-form-submit-utils.ts","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/packages/dev-console/src/components/project-access/project-access-form-submit-utils.ts"],"names":[],"mappings":"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","sourcesContent":["import * as _ from 'lodash';\nimport { k8sCreate, k8sKill, k8sPatch, K8sResourceKind } from '@console/internal/module/k8s';\nimport { RoleBindingModel } from '@console/internal/models';\nimport { generateSecret } from '../import/import-submit-utils';\nimport { Verb, UserRoleBinding } from './project-access-form-utils-types';\n\nexport const getRolesWithNameChange = (\n  newRoles: UserRoleBinding[],\n  removeRoles: UserRoleBinding[],\n) => {\n  const createRoles = _.filter(newRoles, 'roleBindingName');\n  const deleteRoles = _.filter(removeRoles, (o1) =>\n    createRoles.find((o2) => o1.roleBindingName === o2.roleBindingName),\n  );\n  const rolesWithNameChange = _.filter(createRoles, (o1) =>\n    deleteRoles.find(\n      (o2) =>\n        o1.roleBindingName === o2.roleBindingName && o1.user !== o2.user && o1.role === o2.role,\n    ),\n  );\n  return rolesWithNameChange;\n};\n\nexport const sendK8sRequest = (verb: string, roleBinding): Promise<K8sResourceKind> => {\n  switch (verb) {\n    case Verb.Create:\n      return k8sCreate(RoleBindingModel, roleBinding);\n    case Verb.Remove:\n      return k8sKill(RoleBindingModel, roleBinding);\n    case Verb.Patch:\n      return k8sPatch(RoleBindingModel, { metadata: roleBinding.metadata }, [\n        { op: 'replace', path: `/subjects/0`, value: roleBinding.subjects[0] },\n      ]);\n    default:\n      return null;\n  }\n};\n\nexport const generateRoleBindingName = (username: string, role: string) => {\n  return `${username}-${role}-${generateSecret()}`;\n};\n\nexport const getNewRoles = (initialRoles: UserRoleBinding[], formValues: UserRoleBinding[]) => {\n  const newRoles = _.uniqBy(\n    _.filter(\n      formValues,\n      (o1) => !initialRoles.find((o2) => o1.user === o2.user && o1.role === o2.role),\n    ),\n    function(user) {\n      return JSON.stringify([user.user, user.role]);\n    },\n  );\n  return newRoles;\n};\n\nexport const getRemovedRoles = (initialRoles: UserRoleBinding[], formValues: UserRoleBinding[]) => {\n  const removeRoles = _.filter(\n    initialRoles,\n    (o1) => !formValues.find((o2: UserRoleBinding) => o1.user === o2.user && o1.role === o2.role),\n  );\n  return removeRoles;\n};\n\nexport const sendRoleBindingRequest = (verb: string, roles: UserRoleBinding[], roleBinding) => {\n  const finalArray = [];\n  _.forEach(roles, (user) => {\n    const roleBindingName =\n      verb === Verb.Create ? generateRoleBindingName(user.user, user.role) : user.roleBindingName;\n    roleBinding.subjects[0].name = user.user;\n    roleBinding.roleRef.name = user.role;\n    roleBinding.metadata.name = roleBindingName;\n    finalArray.push(sendK8sRequest(verb, roleBinding));\n  });\n  return finalArray;\n};\n"]}]}