{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/public/components/utils/kebab.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/utils/kebab.tsx","mtime":1617671837100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as _ from 'lodash-es';\nimport * as React from 'react';\nimport * as classNames from 'classnames';\nimport * as FocusTrap from 'focus-trap-react';\nimport { connect } from 'react-redux';\nimport { KEY_CODES, Tooltip } from '@patternfly/react-core';\nimport { EllipsisVIcon, AngleRightIcon } from '@patternfly/react-icons';\nimport Popper from '@console/shared/src/components/popper/Popper';\nimport { annotationsModal, configureReplicaCountModal, taintsModal, tolerationsModal, labelsModal, podSelectorModal, deleteModal, expandPVCModal } from '../modals';\nimport { statusModal, claimModal, scanningModal } from '../hypercloud/modals';\nimport { asAccessReview, checkAccess, history, resourceObjPath, useAccessReview } from './index';\nimport { referenceForModel } from '../../module/k8s';\nimport { impersonateStateToProps } from '../../reducers/ui';\nimport { connectToModel } from '../../kinds';\nimport * as plugins from '../../plugins';\nimport { useTranslation } from 'react-i18next';\nimport { ResourceStringKeyMap } from '../../models/hypercloud/resource-plural';\nexport const kebabOptionsToMenu = (options) => {\n    const subs = {};\n    const menuOptions = [];\n    options.forEach(o => {\n        if (!o.hidden) {\n            if (o.path) {\n                const parts = o.path.split('/');\n                parts.forEach((p, i) => {\n                    let subMenu = subs[p];\n                    if (!subs[p]) {\n                        subMenu = {\n                            label: p,\n                            children: [],\n                        };\n                        subs[p] = subMenu;\n                        if (i === 0) {\n                            menuOptions.push(subMenu);\n                        }\n                        else {\n                            subs[parts[i - 1]].children.push(subMenu);\n                        }\n                    }\n                });\n                subs[parts[parts.length - 1]].children.push(o);\n            }\n            else {\n                menuOptions.push(o);\n            }\n        }\n    });\n    return menuOptions;\n};\nconst KebabItem_ = ({ option, onClick, onEscape, autoFocus, isAllowed }) => {\n    var _a;\n    const { t } = useTranslation();\n    const handleEscape = e => {\n        if (e.keyCode === KEY_CODES.ESCAPE_KEY) {\n            onEscape();\n        }\n    };\n    const disabled = !isAllowed || option.isDisabled;\n    const classes = classNames('pf-c-dropdown__menu-item', { 'pf-m-disabled': disabled });\n    // MEMO : i18n 키 값과 변수 값을 한번에 String으로 받아올 수 밖에 없어서 불가피하게 여기서 split으로 나눠서 넣어준다..\n    const labelSplit = (_a = option === null || option === void 0 ? void 0 : option.label) === null || _a === void 0 ? void 0 : _a.split('**');\n    return (React.createElement(\"button\", { className: classes, onClick: e => !disabled && onClick(e, option), autoFocus: autoFocus, onKeyDown: onEscape && handleEscape, \"data-test-action\": option.label },\n        option.icon && React.createElement(\"span\", { className: \"oc-kebab__icon\" }, option.icon),\n        !!labelSplit[1] ? t(labelSplit[0], { 0: t(labelSplit[1]) }) : t(labelSplit[0])));\n};\nconst KebabItemAccessReview_ = (props) => {\n    const { option, impersonate } = props;\n    const isAllowed = useAccessReview(option.accessReview, impersonate);\n    return React.createElement(KebabItem_, Object.assign({}, props, { isAllowed: isAllowed }));\n};\nconst KebabItemAccessReview = connect(impersonateStateToProps)(KebabItemAccessReview_);\nconst KebabSubMenu = ({ option, onClick }) => {\n    const [open, setOpen] = React.useState(false);\n    const nodeRef = React.useRef(null);\n    const subMenuRef = React.useRef(null);\n    const referenceCb = React.useCallback(() => nodeRef.current, []);\n    // use a callback ref because FocusTrap is old and doesn't support non-function refs\n    const subMenuCbRef = React.useCallback(node => (subMenuRef.current = node), []);\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"button\", { ref: nodeRef, className: \"oc-kebab__sub pf-c-dropdown__menu-item\", \"data-test-action\": option.label, \n            // mouse enter will open the sub menu\n            onMouseEnter: () => setOpen(true), onMouseLeave: e => {\n                // if the mouse leaves this item, close the sub menu only if the mouse did not enter the sub menu itself\n                if (!subMenuRef.current || !subMenuRef.current.contains(e.relatedTarget)) {\n                    setOpen(false);\n                }\n            }, onKeyDown: e => {\n                // open the sub menu on enter or right arrow\n                if (e.keyCode === 39 || e.keyCode === 13) {\n                    setOpen(true);\n                    e.stopPropagation();\n                }\n            } },\n            option.label,\n            React.createElement(AngleRightIcon, { className: \"oc-kebab__arrow\" })),\n        React.createElement(Popper, { open: open, placement: \"right-start\", closeOnEsc: true, closeOnOutsideClick: true, onRequestClose: e => {\n                // only close the sub menu if clicking anywhere outside the menu item that owns the sub menu\n                if (!e || !nodeRef.current || !nodeRef.current.contains(e.target)) {\n                    setOpen(false);\n                }\n            }, reference: referenceCb },\n            React.createElement(FocusTrap, { focusTrapOptions: { clickOutsideDeactivates: true } },\n                React.createElement(\"div\", { ref: subMenuCbRef, role: \"presentation\", className: \"pf-c-dropdown pf-m-expanded\", onMouseLeave: e => {\n                        // only close the sub menu if the mouse does not enter the item\n                        if (!nodeRef.current || !nodeRef.current.contains(e.relatedTarget)) {\n                            setOpen(false);\n                        }\n                    }, onKeyDown: e => {\n                        // close the sub menu on left arrow\n                        if (e.keyCode === 37) {\n                            setOpen(false);\n                            e.stopPropagation();\n                        }\n                    } },\n                    React.createElement(KebabMenuItems, { options: option.children, onClick: onClick, className: \"oc-kebab__popper-items\", focusItem: option.children[0] }))))));\n};\nexport const isKebabSubMenu = (option) => {\n    // only a sub menu has children\n    return Array.isArray(option.children);\n};\nexport const KebabItem = props => {\n    const { option } = props;\n    let item;\n    if (option.accessReview) {\n        item = React.createElement(KebabItemAccessReview, Object.assign({}, props));\n    }\n    else {\n        item = React.createElement(KebabItem_, Object.assign({}, props, { isAllowed: true }));\n    }\n    return option.tooltip ? (React.createElement(Tooltip, { position: \"left\", content: option.tooltip }, item)) : (item);\n};\nexport const KebabMenuItems = ({ className, options, onClick, focusItem }) => (React.createElement(\"ul\", { className: classNames('pf-c-dropdown__menu pf-m-align-right', className), \"data-test-id\": \"action-items\" }, _.map(options, o => (React.createElement(\"li\", { key: o.label }, isKebabSubMenu(o) ? React.createElement(KebabSubMenu, { option: o, onClick: onClick }) : React.createElement(KebabItem, { option: o, onClick: onClick, autoFocus: focusItem ? o === focusItem : undefined }))))));\nexport const KebabItems = (_a) => {\n    var { options } = _a, props = __rest(_a, [\"options\"]);\n    const menuOptions = kebabOptionsToMenu(options);\n    return React.createElement(KebabMenuItems, Object.assign({}, props, { options: menuOptions }));\n};\nconst kebabFactory = {\n    Delete: (kind, obj) => {\n        var _a, _b;\n        return ({\n            label: `COMMON:MSG_MAIN_ACTIONBUTTON_16**${(_b = (_a = ResourceStringKeyMap[kind.kind]) === null || _a === void 0 ? void 0 : _a.label) !== null && _b !== void 0 ? _b : kind.label}`,\n            callback: () => deleteModal({\n                kind,\n                resource: obj,\n            }),\n            accessReview: asAccessReview(kind, obj, 'delete'),\n        });\n    },\n    Edit: (kind, obj) => {\n        var _a, _b;\n        return ({\n            label: `COMMON:MSG_MAIN_ACTIONBUTTON_15**${(_b = (_a = ResourceStringKeyMap[kind.kind]) === null || _a === void 0 ? void 0 : _a.label) !== null && _b !== void 0 ? _b : kind.label}`,\n            href: `${resourceObjPath(obj, kind.crd ? referenceForModel(kind) : kind.kind)}/yaml`,\n            // TODO: Fallback to \"View YAML\"? We might want a similar fallback for annotations, labels, etc.\n            accessReview: asAccessReview(kind, obj, 'update'),\n        });\n    },\n    EditSecret: (kind, obj) => {\n        var _a, _b;\n        return ({\n            label: `COMMON:MSG_MAIN_ACTIONBUTTON_15**${(_b = (_a = ResourceStringKeyMap[kind.kind]) === null || _a === void 0 ? void 0 : _a.label) !== null && _b !== void 0 ? _b : kind.label}`,\n            href: `${resourceObjPath(obj, kind.kind)}/edit`,\n            accessReview: asAccessReview(kind, obj, 'update'),\n        });\n    },\n    ModifyLabels: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_4',\n        callback: () => labelsModal({\n            kind,\n            resource: obj,\n            blocking: true,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyStatus: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_31',\n        callback: () => statusModal({\n            kind,\n            resource: obj,\n            blocking: true,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyClaim: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_31',\n        callback: () => claimModal({\n            kind,\n            resource: obj,\n            blocking: true,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyScanning: (kind, obj) => {\n        var _a, _b;\n        let isExtRegistry = false;\n        if (obj.kind === 'ExternalRegistry' || ((_b = (_a = obj.metadata) === null || _a === void 0 ? void 0 : _a.labels) === null || _b === void 0 ? void 0 : _b.app) === 'ext-registry' || obj.isExtRegistry) {\n            isExtRegistry = true;\n        }\n        return {\n            label: 'COMMON:MSG_COMMON_ACTIONBUTTON_20',\n            callback: () => scanningModal({\n                modelKind: kind,\n                resource: obj,\n                blocking: true,\n                isExtRegistry,\n            }),\n        };\n    },\n    ModifyPodSelector: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_6',\n        callback: () => podSelectorModal({\n            kind,\n            resource: obj,\n            blocking: true,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyAnnotations: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_5',\n        callback: () => annotationsModal({\n            kind,\n            resource: obj,\n            blocking: true,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyCount: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_7',\n        callback: () => configureReplicaCountModal({\n            resourceKind: kind,\n            resource: obj,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyTaints: (kind, obj) => ({\n        label: 'Edit Taints',\n        callback: () => taintsModal({\n            resourceKind: kind,\n            resource: obj,\n            modalClassName: 'modal-lg',\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ModifyTolerations: (kind, obj) => ({\n        label: 'Edit Tolerations',\n        callback: () => tolerationsModal({\n            resourceKind: kind,\n            resource: obj,\n            modalClassName: 'modal-lg',\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    AddStorage: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_13',\n        href: `${resourceObjPath(obj, kind.crd ? referenceForModel(kind) : kind.kind)}/attach-storage`,\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    ExpandPVC: (kind, obj) => ({\n        label: 'COMMON:MSG_MAIN_ACTIONBUTTON_3',\n        callback: () => expandPVCModal({\n            kind,\n            resource: obj,\n        }),\n        accessReview: asAccessReview(kind, obj, 'patch'),\n    }),\n    Connect: (kind, obj) => {\n        const { t } = useTranslation();\n        return {\n            label: t('Connect'),\n            callback: () => {\n                let url = `/api/kubeflow/${kind.id}/${obj.metadata.namespace}/${obj.metadata.name}/`;\n                window.open(url);\n            },\n            accessReview: asAccessReview(kind, obj, 'patch'),\n        };\n    }\n};\n// The common menu actions that most resource share\nkebabFactory.common = [kebabFactory.ModifyLabels, kebabFactory.ModifyAnnotations, kebabFactory.Edit, kebabFactory.Delete];\nexport const getExtensionsKebabActionsForKind = (kind) => {\n    const extensionActions = [];\n    _.forEach(plugins.registry.getKebabActions(), (getActions) => {\n        if (getActions) {\n            _.forEach(getActions.properties.getKebabActionsForKind(kind), kebabAction => {\n                extensionActions.push(kebabAction);\n            });\n        }\n    });\n    return extensionActions;\n};\nexport const ResourceKebab = connectToModel((props) => {\n    const { actions, kind, kindObj, resource, isDisabled } = props;\n    if (kind === 'Tag') {\n        const options = _.reject(actions.map(a => a(kindObj, resource)), 'hidden');\n        return React.createElement(Kebab, { options: options, key: resource.version, isDisabled: isDisabled !== undefined ? isDisabled : _.get(resource.metadata, 'deletionTimestamp') });\n    }\n    if (!kindObj) {\n        return null;\n    }\n    const options = _.reject(actions.map(a => a(kindObj, resource)), 'hidden');\n    return React.createElement(Kebab, { options: options, key: resource.metadata.uid, isDisabled: isDisabled !== undefined ? isDisabled : _.get(resource.metadata, 'deletionTimestamp') });\n});\nexport class Kebab extends React.Component {\n    constructor(props) {\n        super(props);\n        this.dropdownElement = React.createRef();\n        this.onClick = (event, option) => {\n            event.preventDefault();\n            if (option.callback) {\n                option.callback();\n            }\n            this.hide();\n            if (option.href) {\n                history.push(option.href);\n            }\n        };\n        this.hide = () => {\n            this.dropdownElement.current && this.dropdownElement.current.focus();\n            this.setState({ active: false });\n        };\n        this.toggle = () => {\n            this.setState(state => ({ active: !state.active }));\n        };\n        this.onHover = () => {\n            // Check access when hovering over a kebab to minimize flicker when opened.\n            // This depends on `checkAccess` being memoized.\n            _.each(this.props.options, (option) => {\n                if (option.accessReview) {\n                    checkAccess(option.accessReview);\n                }\n            });\n        };\n        this.handleRequestClose = (e) => {\n            if (!e || !this.dropdownElement.current || !this.dropdownElement.current.contains(e.target)) {\n                this.hide();\n            }\n        };\n        this.getPopperReference = () => this.dropdownElement.current;\n        this.state = {\n            active: false,\n        };\n    }\n    render() {\n        const { options, isDisabled } = this.props;\n        const menuOptions = kebabOptionsToMenu(options);\n        return (React.createElement(\"div\", { className: classNames({\n                'dropdown pf-c-dropdown': true,\n                'pf-m-expanded': this.state.active,\n            }) },\n            React.createElement(\"button\", { ref: this.dropdownElement, type: \"button\", \"aria-expanded\": this.state.active, \"aria-haspopup\": \"true\", \"aria-label\": \"Actions\", className: \"pf-c-dropdown__toggle pf-m-plain\", \"data-test-id\": \"kebab-button\", disabled: isDisabled, onClick: this.toggle, onFocus: this.onHover, onMouseEnter: this.onHover },\n                React.createElement(EllipsisVIcon, null)),\n            React.createElement(Popper, { open: !isDisabled && this.state.active, placement: \"bottom-end\", closeOnEsc: true, closeOnOutsideClick: true, onRequestClose: this.handleRequestClose, reference: this.getPopperReference },\n                React.createElement(FocusTrap, { focusTrapOptions: { clickOutsideDeactivates: true, returnFocusOnDeactivate: false } },\n                    React.createElement(\"div\", { className: \"pf-c-dropdown pf-m-expanded\" },\n                        React.createElement(KebabMenuItems, { options: menuOptions, onClick: this.onClick, className: \"oc-kebab__popper-items\", focusItem: menuOptions[0] }))))));\n    }\n}\nKebab.factory = kebabFactory;\nKebab.getExtensionsActionsForKind = getExtensionsKebabActionsForKind;\n// public static columnClass: string = 'pf-c-table__action';\nKebab.columnClass = 'dropdown-kebab-pf pf-c-table__action';\nKebabItems.displayName = 'KebabItems';\nResourceKebab.displayName = 'ResourceKebab';\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/utils/kebab.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/public/components/utils/kebab.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as _ from 'lodash-es';\nimport * as React from 'react';\nimport * as classNames from 'classnames';\nimport * as FocusTrap from 'focus-trap-react';\nimport { connect } from 'react-redux';\nimport { KEY_CODES, Tooltip } from '@patternfly/react-core';\nimport { EllipsisVIcon, AngleRightIcon } from '@patternfly/react-icons';\nimport Popper from '@console/shared/src/components/popper/Popper';\nimport { annotationsModal, configureReplicaCountModal, taintsModal, tolerationsModal, labelsModal, podSelectorModal, deleteModal, expandPVCModal } from '../modals';\nimport { statusModal, claimModal, scanningModal } from '../hypercloud/modals';\nimport { asAccessReview, checkAccess, history, resourceObjPath, useAccessReview } from './index';\nimport { AccessReviewResourceAttributes, K8sKind, K8sResourceKind, K8sResourceKindReference, referenceForModel } from '../../module/k8s';\nimport { impersonateStateToProps } from '../../reducers/ui';\nimport { connectToModel } from '../../kinds';\nimport * as plugins from '../../plugins';\nimport { useTranslation } from 'react-i18next';\nimport { ResourceStringKeyMap } from '../../models/hypercloud/resource-plural';\n\nexport const kebabOptionsToMenu = (options: KebabOption[]): KebabMenuOption[] => {\n  const subs: { [key: string]: KebabSubMenu } = {};\n  const menuOptions: KebabMenuOption[] = [];\n\n  options.forEach(o => {\n    if (!o.hidden) {\n      if (o.path) {\n        const parts = o.path.split('/');\n        parts.forEach((p, i) => {\n          let subMenu = subs[p];\n          if (!subs[p]) {\n            subMenu = {\n              label: p,\n              children: [],\n            };\n            subs[p] = subMenu;\n            if (i === 0) {\n              menuOptions.push(subMenu);\n            } else {\n              subs[parts[i - 1]].children.push(subMenu);\n            }\n          }\n        });\n        subs[parts[parts.length - 1]].children.push(o);\n      } else {\n        menuOptions.push(o);\n      }\n    }\n  });\n  return menuOptions;\n};\n\nconst KebabItem_: React.FC<KebabItemProps & { isAllowed: boolean }> = ({ option, onClick, onEscape, autoFocus, isAllowed }) => {\n  const { t } = useTranslation();\n  const handleEscape = e => {\n    if (e.keyCode === KEY_CODES.ESCAPE_KEY) {\n      onEscape();\n    }\n  };\n  const disabled = !isAllowed || option.isDisabled;\n  const classes = classNames('pf-c-dropdown__menu-item', { 'pf-m-disabled': disabled });\n  // MEMO : i18n 키 값과 변수 값을 한번에 String으로 받아올 수 밖에 없어서 불가피하게 여기서 split으로 나눠서 넣어준다..\n  const labelSplit = option?.label?.split('**');\n  return (\n    <button className={classes} onClick={e => !disabled && onClick(e, option)} autoFocus={autoFocus} onKeyDown={onEscape && handleEscape} data-test-action={option.label}>\n      {option.icon && <span className=\"oc-kebab__icon\">{option.icon}</span>}\n      {!!labelSplit[1] ? t(labelSplit[0], { 0: t(labelSplit[1]) }) : t(labelSplit[0])}\n    </button>\n  );\n};\nconst KebabItemAccessReview_ = (props: KebabItemProps & { impersonate: string }) => {\n  const { option, impersonate } = props;\n  const isAllowed = useAccessReview(option.accessReview, impersonate);\n  return <KebabItem_ {...props} isAllowed={isAllowed} />;\n};\n\nconst KebabItemAccessReview = connect(impersonateStateToProps)(KebabItemAccessReview_);\n\ntype KebabSubMenuProps = {\n  option: KebabSubMenu;\n  onClick: KebabItemProps['onClick'];\n};\n\nconst KebabSubMenu: React.FC<KebabSubMenuProps> = ({ option, onClick }) => {\n  const [open, setOpen] = React.useState(false);\n  const nodeRef = React.useRef(null);\n  const subMenuRef = React.useRef(null);\n  const referenceCb = React.useCallback(() => nodeRef.current, []);\n  // use a callback ref because FocusTrap is old and doesn't support non-function refs\n  const subMenuCbRef = React.useCallback(node => (subMenuRef.current = node), []);\n\n  return (\n    <>\n      <button\n        ref={nodeRef}\n        className=\"oc-kebab__sub pf-c-dropdown__menu-item\"\n        data-test-action={option.label}\n        // mouse enter will open the sub menu\n        onMouseEnter={() => setOpen(true)}\n        onMouseLeave={e => {\n          // if the mouse leaves this item, close the sub menu only if the mouse did not enter the sub menu itself\n          if (!subMenuRef.current || !subMenuRef.current.contains(e.relatedTarget as Node)) {\n            setOpen(false);\n          }\n        }}\n        onKeyDown={e => {\n          // open the sub menu on enter or right arrow\n          if (e.keyCode === 39 || e.keyCode === 13) {\n            setOpen(true);\n            e.stopPropagation();\n          }\n        }}\n      >\n        {option.label}\n        <AngleRightIcon className=\"oc-kebab__arrow\" />\n      </button>\n      <Popper\n        open={open}\n        placement=\"right-start\"\n        closeOnEsc\n        closeOnOutsideClick\n        onRequestClose={e => {\n          // only close the sub menu if clicking anywhere outside the menu item that owns the sub menu\n          if (!e || !nodeRef.current || !nodeRef.current.contains(e.target as Node)) {\n            setOpen(false);\n          }\n        }}\n        reference={referenceCb}\n      >\n        <FocusTrap focusTrapOptions={{ clickOutsideDeactivates: true }}>\n          <div\n            ref={subMenuCbRef}\n            role=\"presentation\"\n            className=\"pf-c-dropdown pf-m-expanded\"\n            onMouseLeave={e => {\n              // only close the sub menu if the mouse does not enter the item\n              if (!nodeRef.current || !nodeRef.current.contains(e.relatedTarget as Node)) {\n                setOpen(false);\n              }\n            }}\n            onKeyDown={e => {\n              // close the sub menu on left arrow\n              if (e.keyCode === 37) {\n                setOpen(false);\n                e.stopPropagation();\n              }\n            }}\n          >\n            <KebabMenuItems options={option.children} onClick={onClick} className=\"oc-kebab__popper-items\" focusItem={option.children[0]} />\n          </div>\n        </FocusTrap>\n      </Popper>\n    </>\n  );\n};\n\nexport const isKebabSubMenu = (option: KebabMenuOption): option is KebabSubMenu => {\n  // only a sub menu has children\n  return Array.isArray((option as KebabSubMenu).children);\n};\n\nexport const KebabItem: React.FC<KebabItemProps> = props => {\n  const { option } = props;\n  let item;\n\n  if (option.accessReview) {\n    item = <KebabItemAccessReview {...props} />;\n  } else {\n    item = <KebabItem_ {...props} isAllowed />;\n  }\n\n  return option.tooltip ? (\n    <Tooltip position=\"left\" content={option.tooltip}>\n      {item}\n    </Tooltip>\n  ) : (\n    item\n  );\n};\n\ntype KebabMenuItemsProps = {\n  options: KebabMenuOption[];\n  onClick: (event: React.MouseEvent<{}>, option: KebabOption) => void;\n  focusItem?: KebabOption;\n  className?: string;\n};\n\nexport const KebabMenuItems: React.FC<KebabMenuItemsProps> = ({ className, options, onClick, focusItem }) => (\n  <ul className={classNames('pf-c-dropdown__menu pf-m-align-right', className)} data-test-id=\"action-items\">\n    {_.map(options, o => (\n      <li key={o.label}>{isKebabSubMenu(o) ? <KebabSubMenu option={o} onClick={onClick} /> : <KebabItem option={o} onClick={onClick} autoFocus={focusItem ? o === focusItem : undefined} />}</li>\n    ))}\n  </ul>\n);\n\nexport const KebabItems: React.FC<KebabItemsProps> = ({ options, ...props }) => {\n  const menuOptions = kebabOptionsToMenu(options);\n  return <KebabMenuItems {...props} options={menuOptions} />;\n};\n\nconst kebabFactory: KebabFactory = {\n  Delete: (kind, obj) => ({\n    label: `COMMON:MSG_MAIN_ACTIONBUTTON_16**${ResourceStringKeyMap[kind.kind]?.label ?? kind.label}`,\n    callback: () =>\n      deleteModal({\n        kind,\n        resource: obj,\n      }),\n    accessReview: asAccessReview(kind, obj, 'delete'),\n  }),\n  Edit: (kind, obj) => ({\n    label: `COMMON:MSG_MAIN_ACTIONBUTTON_15**${ResourceStringKeyMap[kind.kind]?.label ?? kind.label}`,\n    href: `${resourceObjPath(obj, kind.crd ? referenceForModel(kind) : kind.kind)}/yaml`,\n    // TODO: Fallback to \"View YAML\"? We might want a similar fallback for annotations, labels, etc.\n    accessReview: asAccessReview(kind, obj, 'update'),\n  }),\n  EditSecret: (kind, obj) => ({\n    label: `COMMON:MSG_MAIN_ACTIONBUTTON_15**${ResourceStringKeyMap[kind.kind]?.label ?? kind.label}`,\n    href: `${resourceObjPath(obj, kind.kind)}/edit`,\n    accessReview: asAccessReview(kind, obj, 'update'),\n  }),\n  ModifyLabels: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_4',\n    callback: () =>\n      labelsModal({\n        kind,\n        resource: obj,\n        blocking: true,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyStatus: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_31',\n    callback: () =>\n      statusModal({\n        kind,\n        resource: obj,\n        blocking: true,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyClaim: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_31',\n    callback: () =>\n      claimModal({\n        kind,\n        resource: obj,\n        blocking: true,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyScanning: (kind, obj) => {\n    let isExtRegistry = false;\n    if (obj.kind === 'ExternalRegistry' || obj.metadata?.labels?.app === 'ext-registry' || obj.isExtRegistry) {\n      isExtRegistry = true;\n    }\n    return {\n      label: 'COMMON:MSG_COMMON_ACTIONBUTTON_20',\n      callback: () =>\n        scanningModal({\n          modelKind: kind,\n          resource: obj,\n          blocking: true,\n          isExtRegistry,\n        }),\n    };\n  },\n  ModifyPodSelector: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_6',\n    callback: () =>\n      podSelectorModal({\n        kind,\n        resource: obj,\n        blocking: true,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyAnnotations: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_5',\n    callback: () =>\n      annotationsModal({\n        kind,\n        resource: obj,\n        blocking: true,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyCount: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_7',\n    callback: () =>\n      configureReplicaCountModal({\n        resourceKind: kind,\n        resource: obj,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyTaints: (kind, obj) => ({\n    label: 'Edit Taints',\n    callback: () =>\n      taintsModal({\n        resourceKind: kind,\n        resource: obj,\n        modalClassName: 'modal-lg',\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ModifyTolerations: (kind, obj) => ({\n    label: 'Edit Tolerations',\n    callback: () =>\n      tolerationsModal({\n        resourceKind: kind,\n        resource: obj,\n        modalClassName: 'modal-lg',\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  AddStorage: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_13',\n    href: `${resourceObjPath(obj, kind.crd ? referenceForModel(kind) : kind.kind)}/attach-storage`,\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  ExpandPVC: (kind, obj) => ({\n    label: 'COMMON:MSG_MAIN_ACTIONBUTTON_3',\n    callback: () =>\n      expandPVCModal({\n        kind,\n        resource: obj,\n      }),\n    accessReview: asAccessReview(kind, obj, 'patch'),\n  }),\n  Connect: (kind, obj) => {\n    const { t } = useTranslation();\n    return {\n      label: t('Connect'),\n      callback: () => {\n        let url = `/api/kubeflow/${kind.id}/${obj.metadata.namespace}/${obj.metadata.name}/`;\n        window.open(url);\n      },\n      accessReview: asAccessReview(kind, obj, 'patch'),\n    };\n  }\n};\n\n// The common menu actions that most resource share\nkebabFactory.common = [kebabFactory.ModifyLabels, kebabFactory.ModifyAnnotations, kebabFactory.Edit, kebabFactory.Delete];\n\nexport const getExtensionsKebabActionsForKind = (kind: K8sKind) => {\n  const extensionActions = [];\n  _.forEach(plugins.registry.getKebabActions(), (getActions: any) => {\n    if (getActions) {\n      _.forEach(getActions.properties.getKebabActionsForKind(kind), kebabAction => {\n        extensionActions.push(kebabAction);\n      });\n    }\n  });\n  return extensionActions;\n};\n\nexport const ResourceKebab = connectToModel((props: ResourceKebabProps) => {\n  const { actions, kind, kindObj, resource, isDisabled } = props;\n\n  if (kind === 'Tag') {\n    const options = _.reject(\n      actions.map(a => a(kindObj, resource)),\n      'hidden',\n    );\n    return <Kebab options={options} key={resource.version} isDisabled={isDisabled !== undefined ? isDisabled : _.get(resource.metadata, 'deletionTimestamp')} />;\n  }\n\n  if (!kindObj) {\n    return null;\n  }\n  const options = _.reject(\n    actions.map(a => a(kindObj, resource)),\n    'hidden',\n  );\n  return <Kebab options={options} key={resource.metadata.uid} isDisabled={isDisabled !== undefined ? isDisabled : _.get(resource.metadata, 'deletionTimestamp')} />;\n});\n\nexport class Kebab extends React.Component<any, { active: boolean }> {\n  static factory: KebabFactory = kebabFactory;\n  static getExtensionsActionsForKind = getExtensionsKebabActionsForKind;\n\n  // public static columnClass: string = 'pf-c-table__action';\n  public static columnClass: string = 'dropdown-kebab-pf pf-c-table__action';\n\n  private dropdownElement = React.createRef<HTMLButtonElement>();\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      active: false,\n    };\n  }\n\n  onClick = (event, option: KebabOption) => {\n    event.preventDefault();\n\n    if (option.callback) {\n      option.callback();\n    }\n\n    this.hide();\n\n    if (option.href) {\n      history.push(option.href);\n    }\n  };\n\n  hide = () => {\n    this.dropdownElement.current && this.dropdownElement.current.focus();\n    this.setState({ active: false });\n  };\n\n  toggle = () => {\n    this.setState(state => ({ active: !state.active }));\n  };\n\n  onHover = () => {\n    // Check access when hovering over a kebab to minimize flicker when opened.\n    // This depends on `checkAccess` being memoized.\n    _.each(this.props.options, (option: KebabOption) => {\n      if (option.accessReview) {\n        checkAccess(option.accessReview);\n      }\n    });\n  };\n\n  handleRequestClose = (e?: MouseEvent) => {\n    if (!e || !this.dropdownElement.current || !this.dropdownElement.current.contains(e.target as Node)) {\n      this.hide();\n    }\n  };\n\n  getPopperReference = () => this.dropdownElement.current;\n\n  render() {\n    const { options, isDisabled } = this.props;\n\n    const menuOptions = kebabOptionsToMenu(options);\n\n    return (\n      <div\n        className={classNames({\n          'dropdown pf-c-dropdown': true,\n          'pf-m-expanded': this.state.active,\n        })}\n      >\n        <button ref={this.dropdownElement} type=\"button\" aria-expanded={this.state.active} aria-haspopup=\"true\" aria-label=\"Actions\" className=\"pf-c-dropdown__toggle pf-m-plain\" data-test-id=\"kebab-button\" disabled={isDisabled} onClick={this.toggle} onFocus={this.onHover} onMouseEnter={this.onHover}>\n          <EllipsisVIcon />\n        </button>\n        <Popper open={!isDisabled && this.state.active} placement=\"bottom-end\" closeOnEsc closeOnOutsideClick onRequestClose={this.handleRequestClose} reference={this.getPopperReference}>\n          <FocusTrap focusTrapOptions={{ clickOutsideDeactivates: true, returnFocusOnDeactivate: false }}>\n            <div className=\"pf-c-dropdown pf-m-expanded\">\n              <KebabMenuItems options={menuOptions} onClick={this.onClick} className=\"oc-kebab__popper-items\" focusItem={menuOptions[0]} />\n            </div>\n          </FocusTrap>\n        </Popper>\n      </div>\n    );\n  }\n}\n\nexport type KebabOption = {\n  hidden?: boolean;\n  label: string;\n  href?: string;\n  callback?: () => any;\n  accessReview?: AccessReviewResourceAttributes;\n  isDisabled?: boolean;\n  tooltip?: string;\n  // a `/` separated string where each segment denotes a new sub menu entry\n  // Eg. `Menu 1/Menu 2/Menu 3`\n  path?: string;\n  icon?: React.ReactNode;\n};\n\nexport type KebabAction = (kind: K8sKind, obj: K8sResourceKind | any, resources?: any, customData?: any) => KebabOption;\n\nexport type ResourceKebabProps = {\n  kindObj: K8sKind;\n  actions: KebabAction[];\n  kind: K8sResourceKindReference;\n  resource: K8sResourceKind | any;\n  isDisabled?: boolean;\n};\n\ntype KebabSubMenu = {\n  label: string;\n  children: KebabMenuOption[];\n};\n\nexport type KebabMenuOption = KebabSubMenu | KebabOption;\n\ntype KebabItemProps = {\n  option: KebabOption;\n  onClick: (event: React.MouseEvent<{}>, option: KebabOption) => void;\n  autoFocus?: boolean;\n  onEscape?: () => void;\n};\n\nexport type KebabItemsProps = {\n  options: KebabOption[];\n  onClick: (event: React.MouseEvent<{}>, option: KebabOption) => void;\n  focusItem?: KebabOption;\n  className?: string;\n};\n\nexport type KebabFactory = { [name: string]: KebabAction } & { common?: KebabAction[] };\n\nKebabItems.displayName = 'KebabItems';\nResourceKebab.displayName = 'ResourceKebab';\n"]}]}