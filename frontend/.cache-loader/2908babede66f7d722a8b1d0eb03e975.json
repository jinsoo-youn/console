{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/public/components/hypercloud/members.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/hypercloud/members.tsx","mtime":1617957501080},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["import * as _ from \"lodash\";\nimport * as React from \"react\";\nimport * as classNames from 'classnames';\nimport * as fuzzy from 'fuzzysearch';\nimport { Button, Dropdown, DropdownToggle, DropdownItem, TextInput } from '@patternfly/react-core';\nimport { EmptyBox, SectionHeading, } from '../utils';\nimport { Table, TableHeader, TableBody, sortable, SortByDirection } from '@patternfly/react-table';\nimport { CaretDownIcon, UsersIcon } from '@patternfly/react-icons';\nimport { useTranslation } from 'react-i18next';\nimport { getId, getUserGroup } from '../../hypercloud/auth';\nimport { coFetchJSON } from \"../../co-fetch\";\nconst ownerData = (owner, t) => [\n    {\n        cells: [`${owner.MemberName} (${t('MULTI:MSG_MULTI_CLUSTERS_MAILFORM_7')})`, owner.MemberId, 'admin'],\n        obj: owner\n    }\n];\nconst tableColumnClasses = ['', '', classNames('pf-m-hidden', 'pf-m-visible-on-sm', 'pf-u-w-16-on-lg'),];\nconst MemberTableRows = (members) => {\n    const data = [];\n    _.forEach(members, (member) => {\n        data.push({\n            cells: [member.Attribute === 'user' ? member.MemberName : React.createElement(React.Fragment, null,\n                    React.createElement(UsersIcon, { className: 'hc-member__group-icon' }),\n                    member.MemberName), member.MemberId, member.Role],\n            obj: member\n        });\n    });\n    return data;\n};\nconst MemberTableHeader = (t) => {\n    return [\n        {\n            title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_2'),\n            transforms: [sortable],\n            props: { className: tableColumnClasses[0] },\n            data: 'MemberName'\n        },\n        {\n            title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_1'),\n            transforms: [sortable],\n            props: { className: tableColumnClasses[1] },\n            data: 'MemberId'\n        },\n        {\n            title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_3'),\n            transforms: [sortable],\n            props: { className: tableColumnClasses[2] },\n            data: 'Role'\n        },\n    ];\n};\nMemberTableHeader.displayName = 'UserTableHeader';\nexport const UsersTable = (props) => {\n    const { isOwner, owner, members, heading, searchType, searchKey } = props;\n    const { t } = useTranslation();\n    const ownerRow = owner ? ownerData.bind(null, owner, t)() : [];\n    const [rows, setRows] = React.useState([]);\n    const [sortBy, setSortBy] = React.useState({ index: 0, sortField: 'MemberName', direction: SortByDirection.asc });\n    const [filteredRows, setFilteredRows] = React.useState([]);\n    const sortRows = ({ sortField, direction }, rows) => {\n        const sortedRows = rows.sort((a, b) => {\n            const compA = typeof a.obj[sortField] === 'string' ? a.obj[sortField].toLowerCase() : a.obj[sortField], compB = typeof b.obj[sortField] === 'string' ? b.obj[sortField].toLowerCase() : b.obj[sortField];\n            return compA < compB ? -1 : compA > compB ? 1 : 0;\n        });\n        setRows(direction === SortByDirection.asc ? _.concat(ownerRow, sortedRows) : _.concat(ownerRow, sortedRows.reverse()));\n    };\n    React.useEffect(() => {\n        sortRows(sortBy, MemberTableRows(members));\n    }, [members]);\n    React.useEffect(() => {\n        const filteredResult = rows.filter(row => fuzzy(_.toLower(searchKey), _.toLower(row.obj[searchType])));\n        setFilteredRows(filteredResult);\n    }, [rows, searchType, searchKey]);\n    const onSort = (_event, index, direction, extraData) => {\n        const sortField = extraData.column.data;\n        sortRows({ sortField, direction }, rows.slice(1));\n        setSortBy({\n            index,\n            sortField,\n            direction\n        });\n    };\n    const actionResolver = (t, rowData, { rowIndex }) => {\n        if (rowData.obj.Status === 'owner') {\n            return null;\n        }\n        return [\n            {\n                title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_ACTIONBUTTON_1'),\n                onClick: (event, rowId, rowData, extra) => {\n                    modifyMemberModal({ modalClassName: 'modal-lg', member: rowData.obj });\n                }\n            },\n            {\n                title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_ACTIONBUTTON_2'),\n                onClick: (event, rowId, rowData, extra) => {\n                    removeMemberModal({ modalClassName: 'modal-lg', member: rowData.obj });\n                }\n            }\n        ];\n    };\n    return (React.createElement(\"div\", { className: \"hc-members__users\" },\n        heading && React.createElement(SectionHeading, { text: heading }),\n        _.isEmpty(filteredRows) ? (React.createElement(EmptyBox, { label: \"Users\" })) : (React.createElement(Table, { \"aria-label\": \"Users\", sortBy: sortBy, onSort: onSort, cells: MemberTableHeader.bind(null, t)(), rows: filteredRows, actionResolver: isOwner && actionResolver.bind(null, t) },\n            React.createElement(TableHeader, null),\n            React.createElement(TableBody, null)))));\n};\nexport const inviteMemberModal = (props) => import('./modals/invite-member-modal' /* webpackChunkName: \"members-modal\" */).then((m) => m.inviteMemberModal(props));\nexport const modifyMemberModal = (props) => import('./modals/modify-member-modal' /* webpackChunkName: \"modify-member-modal\" */).then((m) => m.modifyMemberModal(props));\nexport const removeMemberModal = (props) => import('./modals/remove-member-modal' /* webpackChunkName: \"remove-member-modal\" */).then((m) => m.removeMemberModal(props));\nexport const MembersPage = (props) => {\n    const defaultOwnerData = {\n        Cluster: props.clusterName,\n        MemberId: props.owner,\n        MemberName: \"\",\n        Attribute: \"user\",\n        Role: \"admin\",\n        Status: \"owner\"\n    };\n    const [owner, setOwner] = React.useState(defaultOwnerData);\n    const [members, setMembers] = React.useState([]);\n    const [searchType, setSearchType] = React.useState('MemberName');\n    const [searchKey, setSearchKey] = React.useState('');\n    const [isOpen, setOpen] = React.useState(false);\n    const onToggle = (open) => setOpen(open);\n    const onSelect = event => {\n        const selectedName = event.currentTarget.id;\n        setSearchType(selectedName);\n        setSearchKey('');\n        setOpen(!isOpen);\n    };\n    const handleTextInputChange = value => {\n        setSearchKey(value);\n    };\n    const dropdownItems = (t) => [\n        React.createElement(DropdownItem, { key: \"name\", id: \"MemberName\", component: \"button\" }, t('Name')),\n        React.createElement(DropdownItem, { key: \"email\", id: \"MemberId\", component: \"button\" }, t('Email')),\n    ];\n    React.useEffect(() => {\n        coFetchJSON(`/api/multi-hypercloud/namespaces/${props.namespace}/clustermanagers/${props.clusterName}/member?userId=${getId()}${getUserGroup()}`, 'GET')\n            .then((res) => {\n            let idx = _.findIndex(res, (mem) => mem.Status === \"owner\");\n            idx >= 0 && setOwner(res[idx]);\n            res.splice(idx, 1);\n            setMembers(res);\n        })\n            .catch((err) => {\n            console.log(\"Fail to get member list. \" + err);\n        });\n    }, []);\n    const isOwner = props.owner === getId();\n    const { t } = useTranslation();\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: 'hc-members__header' },\n            React.createElement(Dropdown, { onSelect: onSelect, toggle: React.createElement(DropdownToggle, { id: \"toggle-id\", onToggle: onToggle, iconComponent: CaretDownIcon }, searchType === 'MemberId' ? t('Email') : t('Name')), isOpen: isOpen, dropdownItems: dropdownItems.bind(null, t)() }),\n            React.createElement(TextInput, { className: 'hc-members__search', value: searchKey, onChange: handleTextInputChange, placeholder: searchType === 'MemberId' ? t('search by email') : t('search by name') }),\n            isOwner &&\n                React.createElement(\"div\", { className: \"co-m-primary-action\" },\n                    React.createElement(Button, { variant: \"primary\", id: \"yaml-create\", onClick: () => inviteMemberModal({ clusterName: props.clusterName, modalClassName: 'modal-lg', existMembers: members }) }, t('MULTI:MSG_MULTI_CLUSTERS_INVITEPEOPLEPOPUP_BUTTON_1')))),\n        React.createElement(\"div\", { className: \"hc-members__body\" },\n            React.createElement(UsersTable, { clusterName: props.clusterName, isOwner: isOwner, owner: owner, members: members, searchType: searchType, searchKey: searchKey }))));\n};\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/hypercloud/members.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/public/components/hypercloud/members.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,CAAC,MAAM,QAAQ,CAAC;AAC5B,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,KAAK,UAAU,MAAM,YAAY,CAAC;AACzC,OAAO,KAAK,KAAK,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,cAAc,EAAE,YAAY,EAAE,SAAS,EAAE,MAAM,wBAAwB,CAAC;AACnG,OAAO,EAAE,QAAQ,EAAE,cAAc,GAAc,MAAM,UAAU,CAAC;AAChE,OAAO,EAAE,KAAK,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,EAAE,eAAe,EAAQ,MAAM,yBAAyB,CAAC;AACzG,OAAO,EAAE,aAAa,EAAE,SAAS,EAAE,MAAM,yBAAyB,CAAC;AACnE,OAAO,EAAE,cAAc,EAAE,MAAM,eAAe,CAAC;AAE/C,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,MAAM,uBAAuB,CAAC;AAC5D,OAAO,EAAE,WAAW,EAAE,MAAM,gBAAgB,CAAC;AAE7C,MAAM,SAAS,GAAG,CAAC,KAAK,EAAE,CAAa,EAAE,EAAE,CAAC;IAC1C;QACE,KAAK,EAAE,CAAC,GAAG,KAAK,CAAC,UAAU,KAAK,CAAC,CAAC,qCAAqC,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC;QACrG,GAAG,EAAE,KAAK;KACX;CACF,CAAC;AAEF,MAAM,kBAAkB,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,UAAU,CAAC,aAAa,EAAE,oBAAoB,EAAE,iBAAiB,CAAC,EAAwB,CAAC;AAE/H,MAAM,eAAe,GAAG,CAAC,OAAO,EAAe,EAAE;IAC/C,MAAM,IAAI,GAAG,EAAE,CAAC;IAChB,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,MAAM,EAAE,EAAE;QAC5B,IAAI,CAAC,IAAI,CAAC;YACR,KAAK,EAAE,CAAC,MAAM,CAAC,SAAS,KAAK,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;oBAAE,oBAAC,SAAS,IAAC,SAAS,EAAC,uBAAuB,GAAG;oBAAC,MAAM,CAAC,UAAU,CAAI,EAAE,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAC;YAChK,GAAG,EAAE,MAAM;SACZ,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,OAAO,IAAI,CAAC;AACd,CAAC,CAAA;AAED,MAAM,iBAAiB,GAAG,CAAC,CAAa,EAAE,EAAE;IAC1C,OAAO;QACL;YACE,KAAK,EAAE,CAAC,CAAC,uDAAuD,CAAC;YACjE,UAAU,EAAE,CAAC,QAAQ,CAAC;YACtB,KAAK,EAAE,EAAE,SAAS,EAAE,kBAAkB,CAAC,CAAC,CAAC,EAAE;YAC3C,IAAI,EAAE,YAAY;SACnB;QACD;YACE,KAAK,EAAE,CAAC,CAAC,uDAAuD,CAAC;YACjE,UAAU,EAAE,CAAC,QAAQ,CAAC;YACtB,KAAK,EAAE,EAAE,SAAS,EAAE,kBAAkB,CAAC,CAAC,CAAC,EAAE;YAC3C,IAAI,EAAE,UAAU;SACjB;QACD;YACE,KAAK,EAAE,CAAC,CAAC,uDAAuD,CAAC;YACjE,UAAU,EAAE,CAAC,QAAQ,CAAC;YACtB,KAAK,EAAE,EAAE,SAAS,EAAE,kBAAkB,CAAC,CAAC,CAAC,EAAE;YAC3C,IAAI,EAAE,MAAM;SACb;KAKF,CAAC;AACJ,CAAC,CAAC;AACF,iBAAiB,CAAC,WAAW,GAAG,iBAAiB,CAAC;AAElD,MAAM,CAAC,MAAM,UAAU,GAAG,CAAC,KAAK,EAAE,EAAE;IAClC,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,KAAK,CAAC;IAE1E,MAAM,EAAE,CAAC,EAAE,GAAG,cAAc,EAAE,CAAC;IAC/B,MAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IAE/D,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAC3C,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,SAAS,EAAE,eAAe,CAAC,GAAG,EAAE,CAAC,CAAC;IAClH,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAE3D,MAAM,QAAQ,GAAG,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,EAAE;QAClD,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;YACpC,MAAM,KAAK,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,GAAG,CAAC,SAAS,CAAY,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,EAChH,KAAK,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,GAAG,CAAC,SAAS,CAAY,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAC/G,OAAO,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,SAAS,KAAK,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;IACzH,CAAC,CAAA;IAED,KAAK,CAAC,SAAS,CAAC,GAAG,EAAE;QACnB,QAAQ,CAAC,MAAM,EAAE,eAAe,CAAC,OAAO,CAAC,CAAC,CAAC;IAC7C,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC;IAEd,KAAK,CAAC,SAAS,CAAC,GAAG,EAAE;QACnB,MAAM,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;QACvG,eAAe,CAAC,cAAc,CAAC,CAAC;IAClC,CAAC,EAAE,CAAC,IAAI,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC,CAAC;IAElC,MAAM,MAAM,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,SAAS,EAAE,EAAE;QACrD,MAAM,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,IAAI,CAAA;QACvC,QAAQ,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QAClD,SAAS,CAAC;YACR,KAAK;YACL,SAAS;YACT,SAAS;SACV,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,MAAM,cAAc,GAAG,CAAC,CAAY,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE;QAC7D,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,KAAK,OAAO,EAAE;YAClC,OAAO,IAAI,CAAC;SACb;QAED,OAAO;YACL;gBACE,KAAK,EAAE,CAAC,CAAC,wDAAwD,CAAC;gBAClE,OAAO,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;oBACxC,iBAAiB,CAAC,EAAE,cAAc,EAAE,UAAU,EAAE,MAAM,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC,CAAA;gBACxE,CAAC;aACF;YACD;gBACE,KAAK,EAAE,CAAC,CAAC,wDAAwD,CAAC;gBAClE,OAAO,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;oBACxC,iBAAiB,CAAC,EAAE,cAAc,EAAE,UAAU,EAAE,MAAM,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC,CAAA;gBACxE,CAAC;aACF;SACF,CAAC;IACJ,CAAC,CAAA;IAED,OAAO,CACL,6BAAK,SAAS,EAAC,mBAAmB;QAC/B,OAAO,IAAI,oBAAC,cAAc,IAAC,IAAI,EAAE,OAAO,GAAI;QAC5C,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CACzB,oBAAC,QAAQ,IAAC,KAAK,EAAC,OAAO,GAAG,CAC3B,CAAC,CAAC,CAAC,CACF,oBAAC,KAAK,kBAAY,OAAO,EAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,iBAAiB,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,YAAY,EAAE,cAAc,EAAE,OAAO,IAAI,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;YAC7K,oBAAC,WAAW,OAAG;YACf,oBAAC,SAAS,OAAG,CACP,CACT,CACG,CACP,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,KAAK,EAAE,EAAE,CACzC,MAAM,CAAC,8BAA8B,CAAC,uCAAuC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC;AAEzH,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,KAAK,EAAE,EAAE,CACzC,MAAM,CAAC,8BAA8B,CAAC,6CAA6C,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC;AAE/H,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,KAAK,EAAE,EAAE,CACzC,MAAM,CAAC,8BAA8B,CAAC,6CAA6C,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC;AAE/H,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,KAAK,EAAE,EAAE;IACnC,MAAM,gBAAgB,GACtB;QACE,OAAO,EAAE,KAAK,CAAC,WAAW;QAC1B,QAAQ,EAAE,KAAK,CAAC,KAAK;QACrB,UAAU,EAAE,EAAE;QACd,SAAS,EAAE,MAAM;QACjB,IAAI,EAAE,OAAO;QACb,MAAM,EAAE,OAAO;KAChB,CAAC;IAEF,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;IAC3D,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACjD,MAAM,CAAC,UAAU,EAAE,aAAa,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;IACjE,MAAM,CAAC,SAAS,EAAE,YAAY,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACrD,MAAM,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEhD,MAAM,QAAQ,GAAG,CAAC,IAAa,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,EAAE;QACvB,MAAM,YAAY,GAAG,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC;QAC5C,aAAa,CAAC,YAAY,CAAC,CAAC;QAC5B,YAAY,CAAC,EAAE,CAAC,CAAC;QACjB,OAAO,CAAC,CAAC,MAAM,CAAC,CAAC;IACnB,CAAC,CAAC;IACF,MAAM,qBAAqB,GAAG,KAAK,CAAC,EAAE;QACpC,YAAY,CAAC,KAAK,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,CAAC,CAAa,EAAE,EAAE,CAAC;QACvC,oBAAC,YAAY,IAAC,GAAG,EAAC,MAAM,EAAC,EAAE,EAAC,YAAY,EAAC,SAAS,EAAC,QAAQ,IACxD,CAAC,CAAC,MAAM,CAAC,CACG;QACf,oBAAC,YAAY,IAAC,GAAG,EAAC,OAAO,EAAC,EAAE,EAAC,UAAU,EAAC,SAAS,EAAC,QAAQ,IACvD,CAAC,CAAC,OAAO,CAAC,CACE;KAChB,CAAC;IAEF,KAAK,CAAC,SAAS,CAAC,GAAG,EAAE;QACnB,WAAW,CAAC,oCAAoC,KAAK,CAAC,SAAS,oBAAoB,KAAK,CAAC,WAAW,kBAAkB,KAAK,EAAE,GAAG,YAAY,EAAE,EAAE,EAAE,KAAK,CAAC;aACrJ,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE;YACZ,IAAI,GAAG,GAAG,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,GAAkB,EAAE,EAAE,CAAC,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,CAAC;YAC3E,GAAG,IAAI,CAAC,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAC/B,GAAG,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YAClB,UAAU,CAAC,GAAG,CAAC,CAAC;QAClB,CAAC,CAAC;aACD,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE;YACb,OAAO,CAAC,GAAG,CAAC,2BAA2B,GAAG,GAAG,CAAC,CAAA;QAChD,CAAC,CAAC,CAAC;IACP,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,OAAO,GAAG,KAAK,CAAC,KAAK,KAAK,KAAK,EAAE,CAAC;IACxC,MAAM,EAAE,CAAC,EAAE,GAAG,cAAc,EAAE,CAAC;IAC/B,OAAO,CACL;QACE,6BAAK,SAAS,EAAC,oBAAoB;YACjC,oBAAC,QAAQ,IACP,QAAQ,EAAE,QAAQ,EAClB,MAAM,EACJ,oBAAC,cAAc,IAAC,EAAE,EAAC,WAAW,EAAC,QAAQ,EAAE,QAAQ,EAAE,aAAa,EAAE,aAAa,IAC5E,UAAU,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CACpC,EACnB,MAAM,EAAE,MAAM,EACd,aAAa,EAAE,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE,GAC5C;YACF,oBAAC,SAAS,IAAC,SAAS,EAAC,oBAAoB,EAAC,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,qBAAqB,EAAE,WAAW,EAAE,UAAU,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,GAAc;YAC7L,OAAO;gBACN,6BAAK,SAAS,EAAC,qBAAqB;oBAClC,oBAAC,MAAM,IAAC,OAAO,EAAC,SAAS,EAAC,EAAE,EAAC,aAAa,EAAC,OAAO,EAAE,GAAG,EAAE,CAAC,iBAAiB,CAAC,EAAE,WAAW,EAAE,KAAK,CAAC,WAAW,EAAE,cAAc,EAAE,UAAU,EAAE,YAAY,EAAE,OAAO,EAAE,CAAC,IAC/J,CAAC,CAAC,qDAAqD,CAAC,CAClD,CACL,CACJ;QACN,6BAAK,SAAS,EAAC,kBAAkB;YAC/B,oBAAC,UAAU,IACT,WAAW,EAAE,KAAK,CAAC,WAAW,EAC9B,OAAO,EAAE,OAAO,EAChB,KAAK,EAAE,KAAK,EACZ,OAAO,EAAE,OAAO,EAChB,UAAU,EAAE,UAAU,EACtB,SAAS,EAAE,SAAS,GAAI,CACtB,CACL,CACJ,CAAC;AACJ,CAAC,CAAA","sourcesContent":["import * as _ from \"lodash\";\nimport * as React from \"react\";\nimport * as classNames from 'classnames';\nimport * as fuzzy from 'fuzzysearch';\nimport { Button, Dropdown, DropdownToggle, DropdownItem, TextInput } from '@patternfly/react-core';\nimport { EmptyBox, SectionHeading, /*Kebab,*/ } from '../utils';\nimport { Table, TableHeader, TableBody, sortable, SortByDirection, IRow } from '@patternfly/react-table';\nimport { CaretDownIcon, UsersIcon } from '@patternfly/react-icons';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from \"i18next\";\nimport { getId, getUserGroup } from '../../hypercloud/auth';\nimport { coFetchJSON } from \"../../co-fetch\";\n\nconst ownerData = (owner, t?: TFunction) => [\n  {\n    cells: [`${owner.MemberName} (${t('MULTI:MSG_MULTI_CLUSTERS_MAILFORM_7')})`, owner.MemberId, 'admin'],\n    obj: owner\n  }\n];\n\nconst tableColumnClasses = ['', '', classNames('pf-m-hidden', 'pf-m-visible-on-sm', 'pf-u-w-16-on-lg'), /*Kebab.columnClass*/];\n\nconst MemberTableRows = (members): ITableRow[] => {\n  const data = [];\n  _.forEach(members, (member) => {\n    data.push({\n      cells: [member.Attribute === 'user' ? member.MemberName : <><UsersIcon className='hc-member__group-icon' />{member.MemberName}</>, member.MemberId, member.Role],\n      obj: member\n    });\n  });\n  return data;\n}\n\nconst MemberTableHeader = (t?: TFunction) => {\n  return [\n    {\n      title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_2'),\n      transforms: [sortable],\n      props: { className: tableColumnClasses[0] },\n      data: 'MemberName'\n    },\n    {\n      title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_1'),\n      transforms: [sortable],\n      props: { className: tableColumnClasses[1] },\n      data: 'MemberId'\n    },\n    {\n      title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_TABLEHEADER_3'),\n      transforms: [sortable],\n      props: { className: tableColumnClasses[2] },\n      data: 'Role'\n    },\n    /* {\n      title: '',\n      props: { className: tableColumnClasses[3] },\n    }, */\n  ];\n};\nMemberTableHeader.displayName = 'UserTableHeader';\n\nexport const UsersTable = (props) => {\n  const { isOwner, owner, members, heading, searchType, searchKey } = props;\n\n  const { t } = useTranslation();\n  const ownerRow = owner ? ownerData.bind(null, owner, t)() : [];\n\n  const [rows, setRows] = React.useState([]);\n  const [sortBy, setSortBy] = React.useState({ index: 0, sortField: 'MemberName', direction: SortByDirection.asc });\n  const [filteredRows, setFilteredRows] = React.useState([]);\n\n  const sortRows = ({ sortField, direction }, rows) => {\n    const sortedRows = rows.sort((a, b) => {\n      const compA = typeof a.obj[sortField] === 'string' ? (a.obj[sortField] as string).toLowerCase() : a.obj[sortField],\n        compB = typeof b.obj[sortField] === 'string' ? (b.obj[sortField] as string).toLowerCase() : b.obj[sortField];\n      return compA < compB ? -1 : compA > compB ? 1 : 0;\n    });\n\n    setRows(direction === SortByDirection.asc ? _.concat(ownerRow, sortedRows) : _.concat(ownerRow, sortedRows.reverse()));\n  }\n\n  React.useEffect(() => {\n    sortRows(sortBy, MemberTableRows(members));\n  }, [members]);\n\n  React.useEffect(() => {\n    const filteredResult = rows.filter(row => fuzzy(_.toLower(searchKey), _.toLower(row.obj[searchType])));\n    setFilteredRows(filteredResult);\n  }, [rows, searchType, searchKey]);\n\n  const onSort = (_event, index, direction, extraData) => {\n    const sortField = extraData.column.data\n    sortRows({ sortField, direction }, rows.slice(1));\n    setSortBy({\n      index,\n      sortField,\n      direction\n    });\n  };\n\n  const actionResolver = (t: TFunction, rowData, { rowIndex }) => {\n    if (rowData.obj.Status === 'owner') {\n      return null;\n    }\n\n    return [\n      {\n        title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_ACTIONBUTTON_1'),\n        onClick: (event, rowId, rowData, extra) => {\n          modifyMemberModal({ modalClassName: 'modal-lg', member: rowData.obj })\n        }\n      },\n      {\n        title: t('COMMON:MSG_DETAILS_TABACCESSPERMISSIONS_ACTIONBUTTON_2'),\n        onClick: (event, rowId, rowData, extra) => {\n          removeMemberModal({ modalClassName: 'modal-lg', member: rowData.obj })\n        }\n      }\n    ];\n  }\n\n  return (\n    <div className=\"hc-members__users\">\n      {heading && <SectionHeading text={heading} />}\n      {_.isEmpty(filteredRows) ? (\n        <EmptyBox label=\"Users\" />\n      ) : (\n        <Table aria-label=\"Users\" sortBy={sortBy} onSort={onSort} cells={MemberTableHeader.bind(null, t)()} rows={filteredRows} actionResolver={isOwner && actionResolver.bind(null, t)}>\n          <TableHeader />\n          <TableBody />\n        </Table>\n      )}\n    </div>\n  );\n};\n\nexport const inviteMemberModal = (props) =>\n  import('./modals/invite-member-modal' /* webpackChunkName: \"members-modal\" */).then((m) => m.inviteMemberModal(props));\n\nexport const modifyMemberModal = (props) =>\n  import('./modals/modify-member-modal' /* webpackChunkName: \"modify-member-modal\" */).then((m) => m.modifyMemberModal(props));\n\nexport const removeMemberModal = (props) =>\n  import('./modals/remove-member-modal' /* webpackChunkName: \"remove-member-modal\" */).then((m) => m.removeMemberModal(props));\n\nexport const MembersPage = (props) => {\n  const defaultOwnerData =\n  {\n    Cluster: props.clusterName,\n    MemberId: props.owner,\n    MemberName: \"\",\n    Attribute: \"user\",\n    Role: \"admin\",\n    Status: \"owner\"\n  };\n\n  const [owner, setOwner] = React.useState(defaultOwnerData);\n  const [members, setMembers] = React.useState([]);\n  const [searchType, setSearchType] = React.useState('MemberName');\n  const [searchKey, setSearchKey] = React.useState('');\n  const [isOpen, setOpen] = React.useState(false);\n\n  const onToggle = (open: boolean) => setOpen(open);\n  const onSelect = event => {\n    const selectedName = event.currentTarget.id;\n    setSearchType(selectedName);\n    setSearchKey('');\n    setOpen(!isOpen);\n  };\n  const handleTextInputChange = value => {\n    setSearchKey(value);\n  };\n\n  const dropdownItems = (t?: TFunction) => [\n    <DropdownItem key=\"name\" id=\"MemberName\" component=\"button\">\n      {t('Name')}\n    </DropdownItem>,\n    <DropdownItem key=\"email\" id=\"MemberId\" component=\"button\">\n      {t('Email')}\n    </DropdownItem>,\n  ];\n\n  React.useEffect(() => {\n    coFetchJSON(`/api/multi-hypercloud/namespaces/${props.namespace}/clustermanagers/${props.clusterName}/member?userId=${getId()}${getUserGroup()}`, 'GET')\n      .then((res) => {\n        let idx = _.findIndex(res, (mem: RowMemberData) => mem.Status === \"owner\");\n        idx >= 0 && setOwner(res[idx]);\n        res.splice(idx, 1)\n        setMembers(res);\n      })\n      .catch((err) => {\n        console.log(\"Fail to get member list. \" + err)\n      });\n  }, []);\n\n  const isOwner = props.owner === getId();\n  const { t } = useTranslation();\n  return (\n    <>\n      <div className='hc-members__header'>\n        <Dropdown\n          onSelect={onSelect}\n          toggle={\n            <DropdownToggle id=\"toggle-id\" onToggle={onToggle} iconComponent={CaretDownIcon}>\n              {searchType === 'MemberId' ? t('Email') : t('Name')}\n            </DropdownToggle>}\n          isOpen={isOpen}\n          dropdownItems={dropdownItems.bind(null, t)()}\n        />\n        <TextInput className='hc-members__search' value={searchKey} onChange={handleTextInputChange} placeholder={searchType === 'MemberId' ? t('search by email') : t('search by name')}></TextInput>\n        {isOwner &&\n          <div className=\"co-m-primary-action\">\n            <Button variant=\"primary\" id=\"yaml-create\" onClick={() => inviteMemberModal({ clusterName: props.clusterName, modalClassName: 'modal-lg', existMembers: members })}>\n              {t('MULTI:MSG_MULTI_CLUSTERS_INVITEPEOPLEPOPUP_BUTTON_1')}\n            </Button>\n          </div>}\n      </div>\n      <div className=\"hc-members__body\">\n        <UsersTable\n          clusterName={props.clusterName}\n          isOwner={isOwner}\n          owner={owner}\n          members={members}\n          searchType={searchType}\n          searchKey={searchKey} />\n      </div>\n    </>\n  );\n}\n\nexport type RowMemberData = {\n  Id?: number,\n  Namespace?: string,\n  Cluster?: string,\n  MemberId: string,\n  MemberName: string,\n  Attribute: \"group\" | \"user\",\n  Role: \"guest\" | \"developer\" | \"admin\",\n  Status?: \"invited\" | \"owner\",\n  CreatedTime?: string,\n  UpdatedTime?: string\n};\n\nexport interface ITableRow extends IRow {\n  obj: RowMemberData\n}\n"]}]}