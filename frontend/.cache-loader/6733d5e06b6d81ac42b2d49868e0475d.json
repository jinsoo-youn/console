{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/public/components/dashboard/dashboards-page/cluster-dashboard/details-card.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/dashboard/dashboards-page/cluster-dashboard/details-card.tsx","mtime":1617182414010},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Button } from '@patternfly/react-core';\nimport { ArrowCircleUpIcon, InProgressIcon } from '@patternfly/react-icons';\nimport { FLAGS, getInfrastructureAPIURL, getInfrastructurePlatform } from '@console/shared';\nimport DashboardCard from '@console/shared/src/components/dashboard/dashboard-card/DashboardCard';\nimport DashboardCardBody from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardBody';\nimport DashboardCardHeader from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardHeader';\nimport DashboardCardTitle from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardTitle';\nimport DetailsBody from '@console/shared/src/components/dashboard/details-card/DetailsBody';\nimport DetailItem from '@console/shared/src/components/dashboard/details-card/DetailItem';\nimport { withDashboardResources } from '../../with-dashboard-resources';\nimport { ClusterVersionModel } from '../../../../models';\nimport { referenceForModel, getOpenShiftVersion, getClusterID, getDesiredClusterVersion, getLastCompletedUpdate, getClusterUpdateStatus, getClusterVersionChannel, ClusterUpdateStatus, getOCMLink } from '../../../../module/k8s';\nimport { flagPending, featureReducerName } from '../../../../reducers/features';\nimport { ExternalLink } from '../../../utils';\nimport { clusterUpdateModal } from '../../../modals';\nimport { Link } from 'react-router-dom';\nimport { useK8sWatchResource } from '../../../utils/k8s-watch-hook';\nimport { ClusterDashboardContext } from './context';\nimport { getAccessToken } from '../../../../hypercloud/auth';\nimport { getActivePerspective, getActiveCluster } from '../../../../actions/ui';\nimport { useTranslation } from 'react-i18next';\nimport * as _ from 'lodash';\nimport * as classNames from 'classnames';\nimport './details-card.scss';\nimport { GreenCheckCircleIcon, RedExclamationCircleIcon } from '../../../../../../frontend/packages/console-shared/src/components/status/icons';\nimport { DashboardCardPopupLink } from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardLink';\nconst ClusterVersion = ({ cv }) => {\n    const desiredVersion = getDesiredClusterVersion(cv);\n    const lastVersion = getLastCompletedUpdate(cv);\n    const status = getClusterUpdateStatus(cv);\n    switch (status) {\n        case ClusterUpdateStatus.Updating:\n            return (React.createElement(React.Fragment, null,\n                React.createElement(\"span\", { className: \"co-select-to-copy\" }, desiredVersion),\n                React.createElement(\"div\", null,\n                    React.createElement(Link, { to: \"/settings/cluster/\" },\n                        React.createElement(InProgressIcon, { className: \"co-icon-and-text__icon\" }),\n                        \"Updating\"))));\n        case ClusterUpdateStatus.UpdatesAvailable:\n            return (React.createElement(React.Fragment, null,\n                React.createElement(\"span\", { className: \"co-select-to-copy\" }, desiredVersion),\n                React.createElement(\"div\", null,\n                    React.createElement(Button, { variant: \"link\", className: \"btn-link--no-btn-default-values\", onClick: () => clusterUpdateModal({ cv }), icon: React.createElement(ArrowCircleUpIcon, null), isInline: true }, \"Update\"))));\n        default:\n            return lastVersion ? React.createElement(\"span\", { className: \"co-select-to-copy\" }, lastVersion) : React.createElement(\"span\", { className: \"text-secondary\" }, \"Not available\");\n    }\n};\nconst clusterVersionResource = {\n    kind: referenceForModel(ClusterVersionModel),\n    namespaced: false,\n    name: 'version',\n    isList: false,\n};\nconst mapStateToProps = (state) => ({\n    openshiftFlag: state[featureReducerName].get(FLAGS.OPENSHIFT),\n});\nconst ModuleStatus = ({ status }) => {\n    switch (status) {\n        case 'Normal':\n            return React.createElement(GreenCheckCircleIcon, null);\n        case 'Not Installed':\n            return React.createElement(RedExclamationCircleIcon, null);\n        default:\n            return React.createElement(\"div\", null);\n    }\n};\nexport const DetailsCardPopup = React.memo(({ list }) => {\n    const { t } = useTranslation();\n    return (React.createElement(DashboardCardPopupLink, { linkTitle: String(Object.keys(list).length), popupTitle: t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_TITLE_1'), className: \"co-status-card__popup\" },\n        React.createElement(\"p\", null, t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_DESCRIPTION_1')),\n        React.createElement(\"div\", { className: classNames('details-card__popup-subtitle') }, t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_SOFTWARE_1')),\n        _.map(list, item => (React.createElement(\"div\", { key: _.get(item, 'name') }, _.get(item, 'name'))))));\n});\nconst DetailsSubHeader = React.memo(({ hcVersion }) => {\n    const { t } = useTranslation();\n    console.log(typeof hcVersion);\n    return (React.createElement(DashboardCardHeader, null,\n        React.createElement(\"div\", { className: classNames('details-card__popup-style') }, t('SINGLE:MSG_OVERVIEW_MAIN_CARDSOFTWARE_INSTALLATION_1')),\n        React.createElement(DetailsCardPopup, { list: _.filter(hcVersion, item => item.status === 'Not Installed') })));\n});\nconst DetailsModuleList = React.memo(({ hcVersion, hcVersionError }) => {\n    return (React.createElement(React.Fragment, null, _.map(hcVersion, item => (React.createElement(\"div\", { key: _.get(item, 'name'), className: classNames('details-card__head-style') },\n        React.createElement(\"div\", null,\n            React.createElement(DetailItem, { title: _.get(item, 'name'), error: !!hcVersionError || (item && !_.get(item, 'version')), isLoading: !item, valueClassName: \"co-select-to-copy\" }, _.get(item, 'version'))),\n        React.createElement(\"div\", { className: classNames('details-card__body-icon') },\n            React.createElement(ModuleStatus, { status: _.get(item, 'status') })))))));\n});\nexport const DetailsCard_ = connect(mapStateToProps)(({ watchK8sResource, stopWatchK8sResource, openshiftFlag }) => {\n    const { infrastructure, infrastructureLoaded, infrastructureError } = React.useContext(ClusterDashboardContext);\n    const [hcVersion, setHcVersion] = React.useState();\n    const [hcVersionError, setHcVersionError] = React.useState();\n    const { t } = useTranslation();\n    const [clusterVersionData, clusterVersionLoaded, clusterVersionError] = useK8sWatchResource(clusterVersionResource);\n    React.useEffect(() => {\n        if (flagPending(openshiftFlag)) {\n            return;\n        }\n        const fetchHcVersion = () => __awaiter(void 0, void 0, void 0, function* () {\n            let url;\n            let headers;\n            if (getActivePerspective() === 'master') {\n                url = 'api/hypercloud/version';\n            }\n            else {\n                url = `api/${getActiveCluster()}/version`;\n                headers = new Headers();\n                headers.append('Authorization', `Bearer ${getAccessToken()}`);\n            }\n            try {\n                let version = yield (yield fetch(url)).json();\n                setHcVersion(version);\n            }\n            catch (error) {\n                setHcVersionError(error);\n            }\n        });\n        fetchHcVersion();\n    }, [openshiftFlag, watchK8sResource, stopWatchK8sResource]);\n    const clusterId = getClusterID(clusterVersionData);\n    const openShiftVersion = getOpenShiftVersion(clusterVersionData);\n    const cvChannel = getClusterVersionChannel(clusterVersionData);\n    const infrastructurePlatform = getInfrastructurePlatform(infrastructure);\n    const infrastuctureApiUrl = getInfrastructureAPIURL(infrastructure);\n    return (React.createElement(DashboardCard, { \"data-test-id\": \"details-card\" },\n        React.createElement(DashboardCardHeader, null,\n            React.createElement(DashboardCardTitle, null, t('COMMON:MSG_DETAILS_TAB_1'))),\n        React.createElement(DetailsSubHeader, { hcVersion: hcVersion }),\n        React.createElement(DashboardCardBody, { isLoading: flagPending(openshiftFlag), className: classNames('details-card__body-style') },\n            React.createElement(DetailsBody, null, openshiftFlag ? (React.createElement(React.Fragment, null,\n                React.createElement(DetailItem, { title: \"Cluster API address\", isLoading: !infrastructureLoaded, error: !!infrastructureError || (infrastructure && !infrastuctureApiUrl), valueClassName: \"co-select-to-copy\" }, infrastuctureApiUrl),\n                React.createElement(DetailItem, { title: \"Cluster ID\", error: !!clusterVersionError || (clusterVersionLoaded && !clusterId), isLoading: !clusterVersionLoaded },\n                    React.createElement(\"div\", { className: \"co-select-to-copy\" }, clusterId),\n                    React.createElement(ExternalLink, { text: \"OpenShift Cluster Manager\", href: getOCMLink(clusterId) })),\n                React.createElement(DetailItem, { title: \"Provider\", error: !!infrastructureError || (infrastructure && !infrastructurePlatform), isLoading: !infrastructureLoaded, valueClassName: \"co-select-to-copy\" }, infrastructurePlatform),\n                React.createElement(DetailItem, { title: \"OpenShift version\", error: !!clusterVersionError || (clusterVersionLoaded && !openShiftVersion), isLoading: !clusterVersionLoaded },\n                    React.createElement(ClusterVersion, { cv: clusterVersionData })),\n                React.createElement(DetailItem, { title: \"Update channel\", isLoading: !clusterVersionLoaded && !clusterVersionError, error: !!clusterVersionError || (clusterVersionLoaded && !cvChannel), valueClassName: \"co-select-to-copy\" }, cvChannel))) : (React.createElement(DetailsModuleList, { hcVersion: hcVersion, hcVersionError: hcVersionError }))))));\n});\nexport const DetailsCard = withDashboardResources(DetailsCard_);\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/public/components/dashboard/dashboards-page/cluster-dashboard/details-card.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/public/components/dashboard/dashboards-page/cluster-dashboard/details-card.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Button } from '@patternfly/react-core';\nimport { ArrowCircleUpIcon, InProgressIcon } from '@patternfly/react-icons';\nimport { FLAGS, getInfrastructureAPIURL, getInfrastructurePlatform } from '@console/shared';\nimport DashboardCard from '@console/shared/src/components/dashboard/dashboard-card/DashboardCard';\nimport DashboardCardBody from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardBody';\nimport DashboardCardHeader from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardHeader';\nimport DashboardCardTitle from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardTitle';\nimport DetailsBody from '@console/shared/src/components/dashboard/details-card/DetailsBody';\nimport DetailItem from '@console/shared/src/components/dashboard/details-card/DetailItem';\nimport { DashboardItemProps, withDashboardResources } from '../../with-dashboard-resources';\nimport { ClusterVersionModel } from '../../../../models';\nimport { referenceForModel, getOpenShiftVersion, ClusterVersionKind, getClusterID, getDesiredClusterVersion, getLastCompletedUpdate, getClusterUpdateStatus, getClusterVersionChannel, ClusterUpdateStatus, getOCMLink } from '../../../../module/k8s';\nimport { flagPending, featureReducerName } from '../../../../reducers/features';\nimport { ExternalLink } from '../../../utils';\nimport { RootState } from '../../../../redux';\nimport { clusterUpdateModal } from '../../../modals';\nimport { Link } from 'react-router-dom';\nimport { useK8sWatchResource, WatchK8sResource } from '../../../utils/k8s-watch-hook';\nimport { ClusterDashboardContext } from './context';\nimport { getAccessToken } from '../../../../hypercloud/auth';\nimport { getActivePerspective, getActiveCluster } from '../../../../actions/ui';\nimport { useTranslation } from 'react-i18next';\nimport * as _ from 'lodash';\nimport * as classNames from 'classnames';\nimport './details-card.scss';\n\nimport { GreenCheckCircleIcon, RedExclamationCircleIcon } from '../../../../../../frontend/packages/console-shared/src/components/status/icons';\nimport { DashboardCardPopupLink } from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardLink';\n\nconst ClusterVersion: React.FC<ClusterVersionProps> = ({ cv }) => {\n  const desiredVersion = getDesiredClusterVersion(cv);\n  const lastVersion = getLastCompletedUpdate(cv);\n  const status = getClusterUpdateStatus(cv);\n\n  switch (status) {\n    case ClusterUpdateStatus.Updating:\n      return (\n        <>\n          <span className=\"co-select-to-copy\">{desiredVersion}</span>\n          <div>\n            <Link to=\"/settings/cluster/\">\n              <InProgressIcon className=\"co-icon-and-text__icon\" />\n              Updating\n            </Link>\n          </div>\n        </>\n      );\n    case ClusterUpdateStatus.UpdatesAvailable:\n      return (\n        <>\n          <span className=\"co-select-to-copy\">{desiredVersion}</span>\n          <div>\n            <Button variant=\"link\" className=\"btn-link--no-btn-default-values\" onClick={() => clusterUpdateModal({ cv })} icon={<ArrowCircleUpIcon />} isInline>\n              Update\n            </Button>\n          </div>\n        </>\n      );\n    default:\n      return lastVersion ? <span className=\"co-select-to-copy\">{lastVersion}</span> : <span className=\"text-secondary\">Not available</span>;\n  }\n};\n\nconst clusterVersionResource: WatchK8sResource = {\n  kind: referenceForModel(ClusterVersionModel),\n  namespaced: false,\n  name: 'version',\n  isList: false,\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  openshiftFlag: state[featureReducerName].get(FLAGS.OPENSHIFT),\n});\n\nconst ModuleStatus = ({ status }) => {\n  switch (status) {\n    case 'Normal':\n      return <GreenCheckCircleIcon />;\n    case 'Not Installed':\n      return <RedExclamationCircleIcon />;\n    default:\n      return <div></div>;\n  }\n};\n\nexport const DetailsCardPopup: React.FC<DetailsCardPopupProps> = React.memo(({ list }) => {\n  const { t } = useTranslation();\n  return (\n    <DashboardCardPopupLink linkTitle={String(Object.keys(list).length)} popupTitle={t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_TITLE_1')} className=\"co-status-card__popup\">\n      <p>{t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_DESCRIPTION_1')}</p>\n      <div className={classNames('details-card__popup-subtitle')}>{t('SINGLE:MSG_OVERVIEW_MAIN_POPOVERSOFTWARE_SOFTWARE_1')}</div>\n      {_.map(list, item => (\n        <div key={_.get(item, 'name')}>{_.get(item, 'name')}</div>\n      ))}\n    </DashboardCardPopupLink>\n  );\n});\n\nconst DetailsSubHeader: React.FC<DetailsSubHeaderProps> = React.memo(({ hcVersion }) => {\n  const { t } = useTranslation();\n  console.log(typeof hcVersion);\n  return (\n    <DashboardCardHeader>\n      <div className={classNames('details-card__popup-style')}>{t('SINGLE:MSG_OVERVIEW_MAIN_CARDSOFTWARE_INSTALLATION_1')}</div>\n      <DetailsCardPopup list={_.filter(hcVersion, item => item.status === 'Not Installed')} />\n    </DashboardCardHeader>\n  );\n});\nconst DetailsModuleList: React.FC<DetailsModuleListProps> = React.memo(({ hcVersion, hcVersionError }: DetailsModuleListProps) => {\n  return (\n    <>\n      {_.map(hcVersion, item => (\n        <div key={_.get(item, 'name')} className={classNames('details-card__head-style')}>\n          <div>\n            <DetailItem title={_.get(item, 'name')} error={!!hcVersionError || (item && !_.get(item, 'version'))} isLoading={!item} valueClassName=\"co-select-to-copy\">\n              {_.get(item, 'version')}\n            </DetailItem>\n          </div>\n          <div className={classNames('details-card__body-icon')}>\n            <ModuleStatus status={_.get(item, 'status')} />\n          </div>\n        </div>\n      ))}\n    </>\n  );\n});\n\nexport const DetailsCard_ = connect(mapStateToProps)(({ watchK8sResource, stopWatchK8sResource, openshiftFlag }: DetailsCardProps) => {\n  const { infrastructure, infrastructureLoaded, infrastructureError } = React.useContext(ClusterDashboardContext);\n  const [hcVersion, setHcVersion] = React.useState<Response[]>();\n  const [hcVersionError, setHcVersionError] = React.useState();\n  const { t } = useTranslation();\n  const [clusterVersionData, clusterVersionLoaded, clusterVersionError] = useK8sWatchResource<ClusterVersionKind>(clusterVersionResource);\n  React.useEffect(() => {\n    if (flagPending(openshiftFlag)) {\n      return;\n    }\n    const fetchHcVersion = async () => {\n      let url;\n      let headers;\n      if (getActivePerspective() === 'master') {\n        url = 'api/hypercloud/version';\n      } else {\n        url = `api/${getActiveCluster()}/version`;\n        headers = new Headers();\n        headers.append('Authorization', `Bearer ${getAccessToken()}`);\n      }\n      try {\n        let version = await (await fetch(url)).json();\n        setHcVersion(version);\n      } catch (error) {\n        setHcVersionError(error);\n      }\n    };\n    fetchHcVersion();\n  }, [openshiftFlag, watchK8sResource, stopWatchK8sResource]);\n\n  const clusterId = getClusterID(clusterVersionData);\n  const openShiftVersion = getOpenShiftVersion(clusterVersionData);\n  const cvChannel = getClusterVersionChannel(clusterVersionData);\n\n  const infrastructurePlatform = getInfrastructurePlatform(infrastructure);\n  const infrastuctureApiUrl = getInfrastructureAPIURL(infrastructure);\n  return (\n    <DashboardCard data-test-id=\"details-card\">\n      <DashboardCardHeader>\n        <DashboardCardTitle>{t('COMMON:MSG_DETAILS_TAB_1')}</DashboardCardTitle>\n        {/* <DashboardCardLink to=\"/settings/cluster/\">View settings</DashboardCardLink> */}\n      </DashboardCardHeader>\n      <DetailsSubHeader hcVersion={hcVersion} />\n      <DashboardCardBody isLoading={flagPending(openshiftFlag)} className={classNames('details-card__body-style')}>\n        <DetailsBody>\n          {openshiftFlag ? (\n            <>\n              <DetailItem title=\"Cluster API address\" isLoading={!infrastructureLoaded} error={!!infrastructureError || (infrastructure && !infrastuctureApiUrl)} valueClassName=\"co-select-to-copy\">\n                {infrastuctureApiUrl}\n              </DetailItem>\n              <DetailItem title=\"Cluster ID\" error={!!clusterVersionError || (clusterVersionLoaded && !clusterId)} isLoading={!clusterVersionLoaded}>\n                <div className=\"co-select-to-copy\">{clusterId}</div>\n                <ExternalLink text=\"OpenShift Cluster Manager\" href={getOCMLink(clusterId)} />\n              </DetailItem>\n              <DetailItem title=\"Provider\" error={!!infrastructureError || (infrastructure && !infrastructurePlatform)} isLoading={!infrastructureLoaded} valueClassName=\"co-select-to-copy\">\n                {infrastructurePlatform}\n              </DetailItem>\n              <DetailItem title=\"OpenShift version\" error={!!clusterVersionError || (clusterVersionLoaded && !openShiftVersion)} isLoading={!clusterVersionLoaded}>\n                <ClusterVersion cv={clusterVersionData} />\n              </DetailItem>\n              <DetailItem title=\"Update channel\" isLoading={!clusterVersionLoaded && !clusterVersionError} error={!!clusterVersionError || (clusterVersionLoaded && !cvChannel)} valueClassName=\"co-select-to-copy\">\n                {cvChannel}\n              </DetailItem>\n            </>\n          ) : (\n            <DetailsModuleList hcVersion={hcVersion} hcVersionError={hcVersionError} />\n          )}\n        </DetailsBody>\n      </DashboardCardBody>\n    </DashboardCard>\n  );\n});\n\nexport const DetailsCard = withDashboardResources(DetailsCard_);\n\ntype DetailsCardProps = DashboardItemProps & {\n  openshiftFlag: boolean;\n};\n\ntype ClusterVersionProps = {\n  cv: ClusterVersionKind;\n};\n\ntype DetailsSubHeaderProps = {\n  hcVersion: any;\n};\n\ntype DetailsModuleListProps = {\n  hcVersion: any;\n  hcVersionError: any;\n};\n\ntype DetailsCardPopupProps = {\n  list: any;\n};\n"]}]}