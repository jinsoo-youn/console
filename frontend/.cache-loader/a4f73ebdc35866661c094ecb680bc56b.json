{"remainingRequest":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js??ref--5-2!/home/jinsoo/hypercloud-console5.0/frontend/packages/topology/src/components/layers/Layer.tsx","dependencies":[{"path":"/home/jinsoo/hypercloud-console5.0/frontend/packages/topology/src/components/layers/Layer.tsx","mtime":1615298458710},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1607306270906},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/thread-loader/dist/cjs.js","mtime":1607306283100},{"path":"/home/jinsoo/hypercloud-console5.0/frontend/node_modules/ts-loader/index.js","mtime":1607306283339}],"contextDependencies":[],"result":["import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { createPortal } from 'react-dom';\nimport ElementContext from '../../utils/ElementContext';\nimport LayersContext from './LayersContext';\nimport LayerContainer from './LayerContainer';\nconst ORDER_KEY = '__order__';\nconst compare = (a, b) => {\n    if (a === b) {\n        return 0;\n    }\n    const ao = a[ORDER_KEY];\n    const bo = b[ORDER_KEY];\n    if (ao == null || bo == null) {\n        return 0;\n    }\n    for (let i = 0; i < ao.length; i++) {\n        if (ao[i] !== bo[i]) {\n            return ao[i] - bo[i];\n        }\n    }\n    return ao.length === bo.length ? 0 : ao.length - bo.length;\n};\nconst LayerDelegate = observer(({ id, children, orderKey }) => {\n    const getLayerNode = React.useContext(LayersContext);\n    const layerNode = getLayerNode(id);\n    const element = React.useContext(ElementContext);\n    const nodeRef = React.useRef(null);\n    const order = id ? (orderKey != null ? orderKey : element.getOrderKey()) : undefined;\n    React.useEffect(() => {\n        // TODO use bisection search\n        if (nodeRef.current && layerNode != null) {\n            nodeRef.current[ORDER_KEY] = order;\n            const { childNodes } = layerNode;\n            // childNodes is not an array, disable false positive\n            // eslint-disable-next-line @typescript-eslint/prefer-for-of\n            for (let i = 0; i < childNodes.length; i++) {\n                const result = compare(nodeRef.current, childNodes[i]);\n                if (result < 0) {\n                    if (i > 0 && childNodes[i - 1] !== nodeRef.current) {\n                        layerNode.insertBefore(nodeRef.current, childNodes[i]);\n                    }\n                    return;\n                }\n            }\n            if (childNodes[childNodes.length - 1] !== nodeRef.current) {\n                layerNode.appendChild(nodeRef.current);\n            }\n        }\n    }, [order, layerNode]);\n    return createPortal(React.createElement(LayerContainer, { ref: nodeRef }, children), layerNode);\n});\nconst Layer = ({ id, children, orderKey }) => {\n    return id ? (React.createElement(LayerDelegate, { id: id, orderKey: orderKey }, children)) : (React.createElement(React.Fragment, null, children));\n};\nexport default Layer;\n",{"version":3,"file":"/home/jinsoo/hypercloud-console5.0/frontend/packages/topology/src/components/layers/Layer.tsx","sourceRoot":"","sources":["/home/jinsoo/hypercloud-console5.0/frontend/packages/topology/src/components/layers/Layer.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { createPortal } from 'react-dom';\nimport ElementContext from '../../utils/ElementContext';\nimport LayersContext from './LayersContext';\nimport LayerContainer from './LayerContainer';\n\ntype LayerProps = {\n  id?: string;\n  children: React.ReactNode;\n  orderKey?: number;\n};\n\ntype LayerDelegateProps = {\n  id: string;\n  children: React.ReactNode;\n  orderKey?: number;\n};\n\nconst ORDER_KEY = '__order__';\n\nconst compare = (a: ChildNode, b: ChildNode): number => {\n  if (a === b) {\n    return 0;\n  }\n  const ao = a[ORDER_KEY];\n  const bo = b[ORDER_KEY];\n\n  if (ao == null || bo == null) {\n    return 0;\n  }\n\n  for (let i = 0; i < ao.length; i++) {\n    if (ao[i] !== bo[i]) {\n      return ao[i] - bo[i];\n    }\n  }\n  return ao.length === bo.length ? 0 : ao.length - bo.length;\n};\n\nconst LayerDelegate: React.FC<LayerDelegateProps> = observer(({ id, children, orderKey }) => {\n  const getLayerNode = React.useContext(LayersContext);\n  const layerNode = getLayerNode(id);\n\n  const element = React.useContext(ElementContext);\n  const nodeRef = React.useRef<SVGGElement | null>(null);\n  const order = id ? (orderKey != null ? orderKey : element.getOrderKey()) : undefined;\n\n  React.useEffect(() => {\n    // TODO use bisection search\n    if (nodeRef.current && layerNode != null) {\n      nodeRef.current[ORDER_KEY] = order;\n      const { childNodes } = layerNode;\n      // childNodes is not an array, disable false positive\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let i = 0; i < childNodes.length; i++) {\n        const result = compare(nodeRef.current, childNodes[i]);\n        if (result < 0) {\n          if (i > 0 && childNodes[i - 1] !== nodeRef.current) {\n            layerNode.insertBefore(nodeRef.current, childNodes[i]);\n          }\n          return;\n        }\n      }\n      if (childNodes[childNodes.length - 1] !== nodeRef.current) {\n        layerNode.appendChild(nodeRef.current);\n      }\n    }\n  }, [order, layerNode]);\n\n  return createPortal(<LayerContainer ref={nodeRef}>{children}</LayerContainer>, layerNode);\n});\n\nconst Layer: React.FC<LayerProps> = ({ id, children, orderKey }) => {\n  return id ? (\n    <LayerDelegate id={id} orderKey={orderKey}>\n      {children}\n    </LayerDelegate>\n  ) : (\n    <>{children}</>\n  );\n};\n\nexport default Layer;\n"]}]}