{"version":3,"file":"labels-modal-669a379660ef58a63e02.js","sources":["webpack:///./public/components/modals/labels-modal.jsx"],"sourcesContent":["import * as _ from 'lodash-es';\nimport * as React from 'react';\n\nimport { k8sPatch, referenceForModel } from '../../module/k8s';\nimport { createModalLauncher, ModalTitle, ModalBody, ModalSubmitFooter } from '../factory/modal';\nimport { PromiseComponent, ResourceIcon, SelectorInput } from '../utils';\n\nconst LABELS_PATH = '/metadata/labels';\nconst TEMPLATE_SELECTOR_PATH = '/spec/template/metadata/labels';\n\nclass BaseLabelsModal extends PromiseComponent {\n  constructor(props) {\n    super(props);\n    this._submit = this._submit.bind(this);\n    this._cancel = props.cancel.bind(this);\n    const labels = SelectorInput.arrayify(_.get(props.resource, props.path.split('/').slice(1)));\n    this.state = Object.assign(this.state, {\n      labels,\n    });\n    this.createPath = !labels.length;\n  }\n\n  _submit(e) {\n    e.preventDefault();\n\n    const { kind, path, resource, isPodSelector } = this.props;\n\n    const patch = [\n      {\n        op: this.createPath ? 'add' : 'replace',\n        path,\n        value: SelectorInput.objectify(this.state.labels),\n      },\n    ];\n\n    // https://kubernetes.io/docs/user-guide/deployments/#selector\n    //   .spec.selector must match .spec.template.metadata.labels, or it will be rejected by the API\n    const updateTemplate =\n      isPodSelector && !_.isEmpty(_.get(resource, TEMPLATE_SELECTOR_PATH.split('/').slice(1)));\n\n    if (updateTemplate) {\n      patch.push({\n        path: TEMPLATE_SELECTOR_PATH,\n        op: 'replace',\n        value: SelectorInput.objectify(this.state.labels),\n      });\n    }\n    const promise = k8sPatch(kind, resource, patch);\n    this.handlePromise(promise).then(this.props.close);\n  }\n\n  render() {\n    const { kind, resource, description, message, labelClassName } = this.props;\n\n    return (\n      <form onSubmit={this._submit} name=\"form\" className=\"modal-content\">\n        <ModalTitle>Edit {description || 'Labels'}</ModalTitle>\n        <ModalBody>\n          <div className=\"row co-m-form-row\">\n            <div className=\"col-sm-12\">\n              {message ||\n                'Labels help you organize and select resources. Adding labels below will let you query for objects that have similar, overlapping or dissimilar labels.'}\n            </div>\n          </div>\n          <div className=\"row co-m-form-row\">\n            <div className=\"col-sm-12\">\n              <label htmlFor=\"tags-input\" className=\"control-label\">\n                {_.capitalize(description) || 'Labels'} for{' '}\n                <ResourceIcon kind={kind.crd ? referenceForModel(kind) : kind.kind} />{' '}\n                {resource.metadata.name}\n              </label>\n              <SelectorInput\n                onChange={(labels) => this.setState({ labels })}\n                tags={this.state.labels}\n                labelClassName={labelClassName || `co-text-${kind.id}`}\n                autoFocus\n              />\n            </div>\n          </div>\n        </ModalBody>\n        <ModalSubmitFooter\n          errorMessage={this.state.errorMessage}\n          inProgress={this.state.inProgress}\n          submitText=\"Save\"\n          cancel={this._cancel}\n        />\n      </form>\n    );\n  }\n}\n\nexport const labelsModal = createModalLauncher((props) => (\n  <BaseLabelsModal path={LABELS_PATH} {...props} />\n));\n\nexport const podSelectorModal = createModalLauncher((props) => (\n  <BaseLabelsModal\n    path={\n      ['replicationcontrolleres', 'services'].includes(props.kind.plural)\n        ? '/spec/selector'\n        : '/spec/selector/matchLabels'\n    }\n    isPodSelector={true}\n    description=\"Pod Selector\"\n    message={`Determines the set of pods targeted by this ${props.kind.label.toLowerCase()}.`}\n    labelClassName=\"co-text-pod\"\n    {...props}\n  />\n));\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;;AAAA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;;AAAA;AACA;AAAA;AACA;AAEA;AASA;AAQA;AACA;AAEA;AAIA;AAIA;AACA;;;;;A","sourceRoot":""}