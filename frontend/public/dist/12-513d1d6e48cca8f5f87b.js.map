{"version":3,"file":"12-513d1d6e48cca8f5f87b.js","sources":["webpack:///./packages/operator-lifecycle-manager/src/components/descriptors/spec/resource-requirements.tsx","webpack:///./packages/operator-lifecycle-manager/src/components/descriptors/types.ts","webpack:///./public/components/modals/configure-update-strategy-modal.tsx"],"sourcesContent":["import * as React from 'react';\nimport * as _ from 'lodash';\nimport { connect } from 'react-redux';\nimport { Button } from '@patternfly/react-core';\nimport { PencilAltIcon } from '@patternfly/react-icons';\nimport { withHandlePromise } from '@console/internal/components/utils';\nimport { k8sUpdate, referenceFor, K8sKind, K8sResourceKind } from '@console/internal/module/k8s';\nimport {\n  createModalLauncher,\n  ModalTitle,\n  ModalBody,\n  ModalSubmitFooter,\n} from '@console/internal/components/factory/modal';\nimport { RootState } from '@console/internal/redux';\n\nexport const ResourceRequirements: React.FC<ResourceRequirementsProps> = (props) => {\n  const { cpu, memory, storage, onChangeCPU, onChangeMemory, onChangeStorage, path = '' } = props;\n\n  return (\n    <div className=\"row co-m-form-row\">\n      <div className=\"col-xs-4\">\n        <label\n          style={{ fontWeight: 300 }}\n          className=\"text-muted text-uppercase\"\n          htmlFor={`${path}.cpu`}\n        >\n          CPU cores\n        </label>\n        <input\n          value={cpu}\n          onChange={(e) => onChangeCPU(e.target.value)}\n          id={`${path}.cpu`}\n          name=\"cpu\"\n          type=\"text\"\n          className=\"pf-c-form-control\"\n          placeholder=\"500m\"\n        />\n      </div>\n      <div className=\"col-xs-4\">\n        <label\n          style={{ fontWeight: 300 }}\n          className=\"text-muted text-uppercase\"\n          htmlFor={`${path}.memory`}\n        >\n          Memory\n        </label>\n        <input\n          value={memory}\n          onChange={(e) => onChangeMemory(e.target.value)}\n          id={`${path}.memory`}\n          name=\"memory\"\n          type=\"text\"\n          className=\"pf-c-form-control\"\n          placeholder=\"50Mi\"\n        />\n      </div>\n      <div className=\"col-xs-4\">\n        <label\n          style={{ fontWeight: 300 }}\n          className=\"text-muted text-uppercase\"\n          htmlFor={`${path}.ephemeral-storage`}\n        >\n          Storage\n        </label>\n        <input\n          value={storage}\n          onChange={(e) => onChangeStorage(e.target.value)}\n          id={`${path}.ephemeral-storage`}\n          name=\"ephemeral-storage\"\n          type=\"text\"\n          className=\"pf-c-form-control\"\n          placeholder=\"50Mi\"\n        />\n      </div>\n    </div>\n  );\n};\n\nexport const ResourceRequirementsModal = withHandlePromise(\n  (props: ResourceRequirementsModalProps) => {\n    const { obj, path, type, model } = props;\n    const [cpu, setCPU] = React.useState<string>(_.get(obj.spec, `${path}.${type}.cpu`, ''));\n    const [memory, setMemory] = React.useState<string>(\n      _.get(obj.spec, `${path}.${type}.memory`, ''),\n    );\n    const [storage, setStorage] = React.useState<string>(\n      _.get(obj.spec, `${path}.${type}.ephemeral-storage`),\n    );\n\n    const submit = (e) => {\n      e.preventDefault();\n\n      let newObj = _.cloneDeep(obj);\n      if (cpu !== '' || memory !== '' || storage !== '') {\n        newObj = _.set(newObj, `spec.${path}.${type}`, {\n          cpu,\n          memory,\n          'ephemeral-storage': storage,\n        });\n      }\n\n      return props.handlePromise(k8sUpdate(model, newObj)).then(props.close);\n    };\n\n    return (\n      <form onSubmit={(e) => submit(e)} className=\"modal-content\">\n        <ModalTitle>{props.title}</ModalTitle>\n        <ModalBody>\n          <div className=\"row co-m-form-row\">\n            <div className=\"col-sm-12\">{props.description}</div>\n          </div>\n          <ResourceRequirements\n            cpu={cpu}\n            memory={memory}\n            storage={storage}\n            onChangeCPU={setCPU}\n            onChangeMemory={setMemory}\n            onChangeStorage={setStorage}\n            path={path}\n          />\n        </ModalBody>\n        <ModalSubmitFooter\n          errorMessage={props.errorMessage}\n          inProgress={props.inProgress}\n          submitText=\"Save\"\n          cancel={props.cancel}\n        />\n      </form>\n    );\n  },\n);\n\nconst stateToProps = ({ k8s }: RootState, { obj }) => ({\n  model: k8s.getIn(['RESOURCES', 'models', referenceFor(obj)]) as K8sKind,\n});\n\nexport const ResourceRequirementsModalLink = connect(stateToProps)(\n  (props: ResourceRequirementsModalLinkProps) => {\n    const { obj, type, path, model } = props;\n    const { cpu, memory, 'ephemeral-storage': storage } = _.get(\n      obj.spec,\n      `${path}.${type}`,\n      'none',\n    );\n\n    const onClick = () => {\n      const modal = createModalLauncher(ResourceRequirementsModal);\n      const description = `Define the resource ${type} for this ${obj.kind} instance.`;\n      const title = `${obj.kind} Resource ${_.capitalize(type)}`;\n\n      return modal({ title, description, obj, model, type, path });\n    };\n\n    return (\n      <Button\n        type=\"button\"\n        isInline\n        data-test-id=\"configure-modal-btn\"\n        onClick={onClick}\n        variant=\"link\"\n      >\n        {`CPU: ${cpu || 'none'}, Memory: ${memory || 'none'}, Storage: ${storage || 'none'}`}\n        <PencilAltIcon className=\"co-icon-space-l pf-c-button-icon--plain\" />\n      </Button>\n    );\n  },\n);\n\nexport type ResourceRequirementsModalProps = {\n  title: string;\n  description: string;\n  obj: K8sResourceKind;\n  model: K8sKind;\n  type: 'requests' | 'limits';\n  path: string;\n  handlePromise: <T>(promise: Promise<T>) => Promise<T>;\n  inProgress: boolean;\n  errorMessage: string;\n  cancel?: () => void;\n  close?: () => void;\n};\n\nexport type ResourceRequirementsProps = {\n  cpu: string;\n  memory: string;\n  storage: string;\n  onChangeCPU: (value: string) => void;\n  onChangeMemory: (value: string) => void;\n  onChangeStorage: (value: string) => void;\n  path?: string;\n};\n\nexport type ResourceRequirementsModalLinkProps = {\n  obj: K8sResourceKind;\n  model: K8sKind;\n  type: 'requests' | 'limits';\n  path: string;\n};\n\nResourceRequirements.displayName = 'ResourceRequirements';\nResourceRequirementsModalLink.displayName = 'ResourceRequirementsModalLink';\nResourceRequirementsModal.displayName = 'ResourceRequirementsModal';\n","import { K8sKind, K8sResourceKind } from '@console/internal/module/k8s';\n\nexport enum SpecCapability {\n  podCount = 'urn:alm:descriptor:com.tectonic.ui:podCount',\n  endpointList = 'urn:alm:descriptor:com.tectonic.ui:endpointList',\n  label = 'urn:alm:descriptor:com.tectonic.ui:label',\n  resourceRequirements = 'urn:alm:descriptor:com.tectonic.ui:resourceRequirements',\n  selector = 'urn:alm:descriptor:com.tectonic.ui:selector:',\n  namespaceSelector = 'urn:alm:descriptor:com.tectonic.ui:namespaceSelector',\n  k8sResourcePrefix = 'urn:alm:descriptor:io.kubernetes:',\n  booleanSwitch = 'urn:alm:descriptor:com.tectonic.ui:booleanSwitch',\n\n  password = 'urn:alm:descriptor:com.tectonic.ui:password',\n  checkbox = 'urn:alm:descriptor:com.tectonic.ui:checkbox',\n  imagePullPolicy = 'urn:alm:descriptor:com.tectonic.ui:imagePullPolicy',\n  updateStrategy = 'urn:alm:descriptor:com.tectonic.ui:updateStrategy',\n  text = 'urn:alm:descriptor:com.tectonic.ui:text',\n  number = 'urn:alm:descriptor:com.tectonic.ui:number',\n  nodeAffinity = 'urn:alm:descriptor:com.tectonic.ui:nodeAffinity',\n  podAffinity = 'urn:alm:descriptor:com.tectonic.ui:podAffinity',\n  podAntiAffinity = 'urn:alm:descriptor:com.tectonic.ui:podAntiAffinity',\n  fieldGroup = 'urn:alm:descriptor:com.tectonic.ui:fieldGroup:',\n  arrayFieldGroup = 'urn:alm:descriptor:com.tectonic.ui:arrayFieldGroup:',\n  select = 'urn:alm:descriptor:com.tectonic.ui:select:',\n  advanced = 'urn:alm:descriptor:com.tectonic.ui:advanced',\n  fieldDependency = 'urn:alm:descriptor:com.tectonic.ui:fieldDependency:',\n  hidden = 'urn:alm:descriptor:com.tectonic.ui:hidden',\n}\n\nexport enum StatusCapability {\n  podStatuses = 'urn:alm:descriptor:com.tectonic.ui:podStatuses',\n  podCount = 'urn:alm:descriptor:com.tectonic.ui:podCount',\n  w3Link = 'urn:alm:descriptor:org.w3:link',\n  conditions = 'urn:alm:descriptor:io.kubernetes.conditions',\n  text = 'urn:alm:descriptor:text',\n  prometheusEndpoint = 'urn:alm:descriptor:prometheusEndpoint',\n  k8sPhase = 'urn:alm:descriptor:io.kubernetes.phase',\n  k8sPhaseReason = 'urn:alm:descriptor:io.kubernetes.phase:reason',\n  // Prefix for all kubernetes resource status descriptors.\n  k8sResourcePrefix = 'urn:alm:descriptor:io.kubernetes:',\n  hidden = 'urn:alm:descriptor:com.tectonic.ui:hidden',\n}\n\nexport type Descriptor<T = any> = {\n  path: string;\n  displayName: string;\n  description: string;\n  'x-descriptors'?: T[];\n  value?: any;\n};\n\nexport type SpecDescriptor = Descriptor<SpecCapability>;\nexport type StatusDescriptor = Descriptor<StatusCapability>;\n\nexport type DescriptorProps = {\n  descriptor: Descriptor;\n  value: any;\n  obj: K8sResourceKind;\n  model: K8sKind;\n  namespace?: string;\n  onHandleError?: (message: string) => void;\n};\n\nexport type CapabilityProps<C extends SpecCapability | StatusCapability> = {\n  descriptor: Descriptor;\n  capability: C;\n  value: any;\n  obj?: K8sResourceKind;\n  model?: K8sKind;\n  namespace?: string;\n  onHandleError?: (message: string) => void;\n};\n\nexport type Error = { message: string };\n","import * as _ from 'lodash-es';\nimport * as React from 'react';\nimport { Tooltip } from '@patternfly/react-core';\n\nimport { k8sPatch, Patch, DeploymentUpdateStrategy, K8sResourceKind } from '../../module/k8s';\nimport { DeploymentModel } from '../../models';\nimport { createModalLauncher, ModalTitle, ModalBody, ModalSubmitFooter } from '../factory/modal';\nimport { pluralize, withHandlePromise } from '../utils';\nimport { RadioInput } from '../radio';\n\nexport const UPDATE_STRATEGY_DESCRIPTION =\n  'How should the pods be replaced when a new revision is created?';\n\nexport const getNumberOrPercent = (value) => {\n  if (typeof value === 'undefined') {\n    return null;\n  }\n  if (typeof value === 'string' && value.indexOf('%') > -1) {\n    return value;\n  }\n\n  return _.toInteger(value);\n};\n\nexport const ConfigureUpdateStrategy: React.FC<ConfigureUpdateStrategyProps> = (props) => {\n  const { showDescription = true } = props;\n  return (\n    <>\n      {showDescription && (\n        <div className=\"co-m-form-row\">\n          <p>{UPDATE_STRATEGY_DESCRIPTION}</p>\n        </div>\n      )}\n      <div className=\"row co-m-form-row\">\n        <div className=\"col-sm-12\">\n          <RadioInput\n            name={`${props.uid || 'update-strategy'}-type`}\n            onChange={(e) => {\n              props.onChangeStrategyType(e.target.value);\n            }}\n            value=\"RollingUpdate\"\n            checked={props.strategyType === 'RollingUpdate'}\n            title=\"RollingUpdate\"\n            subTitle=\"(default)\"\n            autoFocus={props.strategyType === 'RollingUpdate'}\n          >\n            <div className=\"co-m-radio-desc\">\n              <p className=\"text-muted\">\n                Execute a smooth roll out of the new revision, based on the settings below\n              </p>\n\n              <div className=\"row co-m-form-row\">\n                <div className=\"col-sm-3\">\n                  <label htmlFor=\"input-max-unavailable\" className=\"control-label\">\n                    Max Unavailable\n                  </label>\n                </div>\n                <div className=\"co-m-form-col col-sm-9\">\n                  <div className=\"form-inline\">\n                    <div className=\"pf-c-input-group\">\n                      <input\n                        disabled={props.strategyType !== 'RollingUpdate'}\n                        placeholder=\"25%\"\n                        size={5}\n                        type=\"text\"\n                        className=\"pf-c-form-control\"\n                        id=\"input-max-unavailable\"\n                        value={props.maxUnavailable}\n                        onChange={(e) => props.onChangeMaxUnavailable(e.target.value)}\n                        aria-describedby=\"input-max-unavailable-help\"\n                      />\n                      {props.replicas && (\n                        <span className=\"pf-c-input-group__text\">\n                          <Tooltip content=\"Current desired pod count\">\n                            <span>of {pluralize(props.replicas, 'pod')}</span>\n                          </Tooltip>\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                  <p className=\"help-block text-muted\" id=\"input-max-unavailable-help\">\n                    Number or percentage of total pods at the start of the update (optional)\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"row co-m-form-row\">\n                <div className=\"col-sm-3\">\n                  <label htmlFor=\"input-max-surge\" className=\"control-label\">\n                    Max Surge\n                  </label>\n                </div>\n                <div className=\"co-m-form-col col-sm-9\">\n                  <div className=\"form-inline\">\n                    <div className=\"pf-c-input-group\">\n                      <input\n                        disabled={props.strategyType !== 'RollingUpdate'}\n                        placeholder=\"25%\"\n                        size={5}\n                        type=\"text\"\n                        className=\"pf-c-form-control\"\n                        id=\"input-max-surge\"\n                        value={props.maxSurge}\n                        onChange={(e) => props.onChangeMaxSurge(e.target.value)}\n                        aria-describedby=\"input-max-surge-help\"\n                      />\n                      <span className=\"pf-c-input-group__text\">\n                        <Tooltip content=\"Current desired pod count\">\n                          <span>greater than {pluralize(props.replicas, 'pod')}</span>\n                        </Tooltip>\n                      </span>\n                    </div>\n                  </div>\n                  <p className=\"help-block text-muted\" id=\"input-max-surge-help\">\n                    Number or percentage of total pods at the start of the update (optional)\n                  </p>\n                </div>\n              </div>\n            </div>\n          </RadioInput>\n        </div>\n\n        <div className=\"col-sm-12\">\n          <RadioInput\n            name={`${props.uid || 'update-strategy'}-type`}\n            onChange={(e) => {\n              props.onChangeStrategyType(e.target.value);\n            }}\n            value=\"Recreate\"\n            checked={props.strategyType === 'Recreate'}\n            title=\"Recreate\"\n            desc=\"Shut down all existing pods before creating new ones\"\n            autoFocus={props.strategyType === 'Recreate'}\n          />\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport const ConfigureUpdateStrategyModal = withHandlePromise(\n  (props: ConfigureUpdateStrategyModalProps) => {\n    const [strategyType, setStrategyType] = React.useState(\n      _.get(props.deployment.spec, 'strategy.type'),\n    );\n    const [maxUnavailable, setMaxUnavailable] = React.useState(\n      _.get(props.deployment.spec, 'strategy.rollingUpdate.maxUnavailable', '25%'),\n    );\n    const [maxSurge, setMaxSurge] = React.useState(\n      _.get(props.deployment.spec, 'strategy.rollingUpdate.maxSurge', '25%'),\n    );\n\n    const submit = (event) => {\n      event.preventDefault();\n\n      const patch: Patch = { path: '/spec/strategy/rollingUpdate', op: 'remove' };\n      if (strategyType === 'RollingUpdate') {\n        patch.value = {\n          maxUnavailable: getNumberOrPercent(maxUnavailable || '25%'),\n          maxSurge: getNumberOrPercent(maxSurge || '25%'),\n        };\n        patch.op = 'add';\n      }\n\n      props\n        .handlePromise(\n          k8sPatch(DeploymentModel, props.deployment, [\n            patch,\n            { path: '/spec/strategy/type', value: strategyType, op: 'replace' },\n          ]),\n        )\n        .then(props.close, () => {});\n    };\n\n    return (\n      <form onSubmit={submit} name=\"form\" className=\"modal-content\">\n        <ModalTitle>Edit Update Strategy</ModalTitle>\n        <ModalBody>\n          <ConfigureUpdateStrategy\n            strategyType={strategyType}\n            maxUnavailable={maxUnavailable}\n            maxSurge={maxSurge}\n            onChangeStrategyType={setStrategyType}\n            onChangeMaxUnavailable={setMaxUnavailable}\n            onChangeMaxSurge={setMaxSurge}\n          />\n        </ModalBody>\n        <ModalSubmitFooter\n          errorMessage={props.errorMessage}\n          inProgress={props.inProgress}\n          submitText=\"Save\"\n          cancel={props.cancel}\n        />\n      </form>\n    );\n  },\n);\n\nexport const configureUpdateStrategyModal = createModalLauncher(ConfigureUpdateStrategyModal);\n\nexport type ConfigureUpdateStrategyProps = {\n  showDescription?: boolean;\n  strategyType: DeploymentUpdateStrategy['type'];\n  maxUnavailable: number | string;\n  maxSurge: number | string;\n  onChangeStrategyType: (strategy: DeploymentUpdateStrategy['type']) => void;\n  onChangeMaxUnavailable: (maxUnavailable: number | string) => void;\n  onChangeMaxSurge: (maxSurge: number | string) => void;\n  replicas?: number;\n  uid?: string;\n};\n\nexport type ConfigureUpdateStrategyModalProps = {\n  deployment: K8sResourceKind;\n  handlePromise: <T>(promise: Promise<T>) => Promise<T>;\n  inProgress: boolean;\n  errorMessage: string;\n  cancel?: () => void;\n  close?: () => void;\n};\n\nConfigureUpdateStrategy.displayName = 'ConfigureUpdateStrategy';\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AAEA;AAEA;AACA;AAOA;AAUA;AACA;AAOA;AAUA;AACA;AAOA;AAYA;AAEA;AAEA;AACA;AACA;AAGA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAUA;AAQA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AAMA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAQA;AACA;AAGA;AAkCA;AACA;AACA;;;;;;;;;;;;;ACvMA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AAGA;AACA;AAOA;AACA;AAIA;AACA;AACA;AAIA;AACA;AACA;AACA;AAWA;AAEA;AACA;;AAAA;AAMA;AAMA;AACA;AACA;AAIA;AACA;AACA;AACA;AAWA;AACA;AACA;;AAAA;AAKA;AASA;AACA;AAGA;AACA;AAWA;AAEA;AAEA;AAGA;AAGA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AASA;AAQA;AAGA;AAuBA;;;;;A","sourceRoot":""}