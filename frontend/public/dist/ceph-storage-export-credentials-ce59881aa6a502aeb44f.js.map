{"version":3,"file":"ceph-storage-export-credentials-ce59881aa6a502aeb44f.js","sources":["webpack:///./packages/ceph-storage-plugin/src/components/converged-credentials/credentials.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Base64 } from 'js-base64';\nimport { k8sGet } from '@console/internal/module/k8s';\nimport { SecretModel, ConfigMapModel } from '@console/internal/models';\nimport { createModalLauncher, ModalComponentProps } from '@console/internal/components/factory';\nimport { CEPH_STORAGE_NAMESPACE } from '../../constants';\n\nconst createJSONFile = (data: Credentials) =>\n  `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(data))}`;\n\nconst ExportCredentials: React.FC<ModalComponentProps> = (props) => {\n  const ref = React.useRef<HTMLAnchorElement>();\n  const [payload, setPayload] = React.useState('');\n  React.useEffect(() => {\n    Promise.all([\n      k8sGet(SecretModel, 'rook-ceph-mon', CEPH_STORAGE_NAMESPACE),\n      k8sGet(ConfigMapModel, 'rook-ceph-mon-endpoints', CEPH_STORAGE_NAMESPACE),\n    ])\n      .then((data) => {\n        const fsid = Base64.decode(data?.[0]?.data?.fsid);\n        const adminSecret = Base64.decode(data?.[0]?.data?.['admin-secret']);\n        const monIP = data?.[1]?.data?.data.split(',')?.[0];\n        setPayload(\n          createJSONFile({\n            admin: adminSecret,\n            monData: monIP,\n            // Todo(bipuladh): Change this when OCS supports multiple NS's\n            clusterName: CEPH_STORAGE_NAMESPACE,\n            fsid,\n          }),\n        );\n        ref.current.click();\n        props.close();\n      })\n      .catch((err) => {\n        // eslint-disable-next-line no-console\n        console.error('Error exporting credentials', err);\n        props.close();\n      });\n    // No need to run the effect multiple times\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return (\n    <a\n      id=\"downloadAnchorElem\"\n      href={payload}\n      download=\"credentials.json\"\n      ref={ref}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n    >\n      Download\n    </a>\n  );\n};\n\ntype Credentials = {\n  admin: string;\n  monData: string;\n  clusterName: string;\n  fsid: string;\n};\n\nexport default createModalLauncher(ExportCredentials);\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AASA;;;;;A","sourceRoot":""}