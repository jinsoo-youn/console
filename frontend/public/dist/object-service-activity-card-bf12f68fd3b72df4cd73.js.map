{"version":3,"file":"object-service-activity-card-bf12f68fd3b72df4cd73.js","sources":["webpack:///./packages/noobaa-storage-plugin/src/components/activity-card/activity-card.scss?0ce9","webpack:///./packages/noobaa-storage-plugin/src/components/activity-card/activity-card.tsx","webpack:///./packages/noobaa-storage-plugin/src/constants/index.ts","webpack:///./packages/noobaa-storage-plugin/src/queries.ts"],"sourcesContent":["// extracted by mini-css-extract-plugin","import * as React from 'react';\nimport * as _ from 'lodash';\nimport DashboardCard from '@console/shared/src/components/dashboard/dashboard-card/DashboardCard';\nimport DashboardCardBody from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardBody';\nimport DashboardCardHeader from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardHeader';\nimport DashboardCardTitle from '@console/shared/src/components/dashboard/dashboard-card/DashboardCardTitle';\nimport { EventKind } from '@console/internal/module/k8s';\nimport { FirehoseResource, FirehoseResult } from '@console/internal/components/utils';\nimport { EventModel, StatefulSetModel, PodModel } from '@console/internal/models';\nimport ActivityBody, {\n  RecentEventsBody,\n  OngoingActivityBody,\n} from '@console/shared/src/components/dashboard/activity-card/ActivityBody';\nimport { PrometheusResponse } from '@console/internal/components/graphs';\nimport {\n  DashboardItemProps,\n  withDashboardResources,\n} from '@console/internal/components/dashboard/with-dashboard-resources';\nimport { getResiliencyProgress } from '@console/ceph-storage-plugin/src/utils';\nimport { DATA_RESILIENCE_QUERIES } from '../../queries';\nimport {\n  NooBaaBackingStoreModel,\n  NooBaaBucketClassModel,\n  NooBaaObjectBucketClaimModel,\n} from '../../models';\nimport './activity-card.scss';\n\nconst eventsResource: FirehoseResource = { isList: true, kind: EventModel.kind, prop: 'events' };\n\nconst isNoobaaEventObject = (event: EventKind): boolean => {\n  const eventName: string = event?.involvedObject?.name;\n  return _.startsWith(eventName, 'noobaa');\n};\n\nconst noobaaEventsFilter = (event: EventKind): boolean => {\n  const eventKind: string = event?.involvedObject?.kind;\n  const noobaaResources = [\n    NooBaaBackingStoreModel.kind,\n    NooBaaBucketClassModel.kind,\n    NooBaaObjectBucketClaimModel.kind,\n  ];\n  if (eventKind === PodModel.kind || eventKind === StatefulSetModel.kind) {\n    return isNoobaaEventObject(event);\n  }\n  return noobaaResources.includes(eventKind);\n};\n\nconst RecentEvent = withDashboardResources(\n  ({ watchK8sResource, stopWatchK8sResource, resources }: DashboardItemProps) => {\n    React.useEffect(() => {\n      watchK8sResource(eventsResource);\n      return () => {\n        stopWatchK8sResource(eventsResource);\n      };\n    }, [watchK8sResource, stopWatchK8sResource]);\n    return (\n      <RecentEventsBody\n        events={resources.events as FirehoseResult<EventKind[]>}\n        filter={noobaaEventsFilter}\n      />\n    );\n  },\n);\n\nconst OngoingActivity = withDashboardResources(\n  ({ watchPrometheus, stopWatchPrometheusQuery, prometheusResults }: DashboardItemProps) => {\n    React.useEffect(() => {\n      watchPrometheus(DATA_RESILIENCE_QUERIES.REBUILD_PROGRESS_QUERY);\n      watchPrometheus(DATA_RESILIENCE_QUERIES.REBUILD_TIME_QUERY);\n      return () => {\n        stopWatchPrometheusQuery(DATA_RESILIENCE_QUERIES.REBUILD_PROGRESS_QUERY);\n        stopWatchPrometheusQuery(DATA_RESILIENCE_QUERIES.REBUILD_TIME_QUERY);\n      };\n    }, [watchPrometheus, stopWatchPrometheusQuery]);\n\n    const progress = prometheusResults.getIn([\n      DATA_RESILIENCE_QUERIES.REBUILD_PROGRESS_QUERY,\n      'data',\n    ]) as PrometheusResponse;\n    const progressError = prometheusResults.getIn([\n      DATA_RESILIENCE_QUERIES.REBUILD_PROGRESS_QUERY,\n      'loadError',\n    ]);\n\n    const eta = prometheusResults.getIn([\n      DATA_RESILIENCE_QUERIES.REBUILD_TIME_QUERY,\n      'data',\n    ]) as PrometheusResponse;\n\n    const prometheusActivities = [];\n\n    if (getResiliencyProgress(progress) < 1) {\n      prometheusActivities.push({\n        results: [progress, eta],\n        loader: () =>\n          import('./data-resiliency-activity/data-resiliency-activity').then(\n            (m) => m.NoobaaDataResiliency,\n          ),\n      });\n    }\n\n    return (\n      <OngoingActivityBody\n        loaded={progress || progressError}\n        prometheusActivities={prometheusActivities}\n      />\n    );\n  },\n);\n\nconst ActivityCard: React.FC<{}> = () => (\n  <DashboardCard gradient>\n    <DashboardCardHeader>\n      <DashboardCardTitle>Activity</DashboardCardTitle>\n    </DashboardCardHeader>\n    <DashboardCardBody>\n      <ActivityBody className=\"nb-activity-card__body\">\n        <OngoingActivity />\n        <RecentEvent />\n      </ActivityBody>\n    </DashboardCardBody>\n  </DashboardCard>\n);\n\nexport default ActivityCard;\n","export const ACCOUNTS = 'Accounts';\nexport const PROVIDERS = 'Providers';\nexport const BY_IOPS = 'I/O Operations';\nexport const BY_LOGICAL_USAGE = 'Logical Used Capacity';\nexport const BY_PHYSICAL_VS_LOGICAL_USAGE = 'Physical Vs Logical Usage';\nexport const BY_EGRESS = 'Egress';\nexport const PROJECTS = 'Projects';\nexport const BUCKET_CLASS = 'Bucket Class';\nexport const OCS_NS = 'openshift-storage';\nexport const NB_PROVISIONER = 'noobaa.io/obc';\n\nexport const CHART_LABELS = {\n  [BY_LOGICAL_USAGE]: 'Logical used capacity per account',\n  [BY_PHYSICAL_VS_LOGICAL_USAGE]: 'Physical vs. Logical used capacity',\n  [BY_EGRESS]: 'Egress Per Provider',\n  [BY_IOPS]: 'I/O Operations count',\n};\n\nexport enum BC_PROVIDERS {\n  AWS = 'AWS S3',\n  S3 = 'S3 Compatible',\n  PVC = 'PVC',\n  GCP = 'Google cloud storage',\n  AZURE = 'Azure Blob',\n  IBM = 'IBM COS',\n}\n\nexport const PROVIDERS_NOOBAA_MAP = {\n  [BC_PROVIDERS.AWS]: 'awsS3',\n  [BC_PROVIDERS.S3]: 's3Compatible',\n  [BC_PROVIDERS.AZURE]: 'azureBlob',\n  [BC_PROVIDERS.GCP]: 'googleCloudStorage',\n  [BC_PROVIDERS.PVC]: 'pvPool',\n  [BC_PROVIDERS.IBM]: 'ibmCos',\n};\n\nexport const BUCKET_LABEL_NOOBAA_MAP = {\n  [BC_PROVIDERS.AWS]: 'targetBucket',\n  [BC_PROVIDERS.S3]: 'targetBucket',\n  [BC_PROVIDERS.AZURE]: 'targetBlobContainer',\n  [BC_PROVIDERS.GCP]: 'targetBucket',\n  [BC_PROVIDERS.IBM]: 'targetBucket',\n};\n\nexport const NOOBAA_TYPE_MAP = {\n  [BC_PROVIDERS.AWS]: 'aws-s3',\n  [BC_PROVIDERS.S3]: 's3-compatible',\n  [BC_PROVIDERS.AZURE]: 'azure-blob',\n  [BC_PROVIDERS.GCP]: 'google-cloud-storage',\n  [BC_PROVIDERS.PVC]: 'pv-pool',\n  [BC_PROVIDERS.IBM]: 'ibm-cos',\n};\n\nexport const AWS_REGIONS = [\n  'us-east-1',\n  'us-east-2',\n  'us-west-1',\n  'us-west-2',\n  'ca-central-1',\n  'eu-central-1',\n  'eu-west-1',\n  'eu-west-2',\n  'eu-west-3',\n  'eu-north-1',\n  'ap-east-1',\n  'ap-northeast-1',\n  'ap-northeast-2',\n  'ap-northeast-3',\n  'ap-southeast-1',\n  'ap-southeast-2',\n  'ap-south-1',\n  'me-south-1',\n  'sa-east-1',\n];\n","import { ProjectModel } from '@console/internal/models';\nimport { PROJECTS, BUCKET_CLASS } from './constants';\nimport { NooBaaBucketClassModel } from './models';\n\nexport enum ObjectDashboardQuery {\n  CAPACITY_USAGE_PROJECT_QUERY = 'CAPACITY_USAGE_PROJECT_QUERY',\n  CAPACITY_USAGE_BUCKET_CLASS_QUERY = 'CAPACITY_USAGE_BUCKET_CLASS_QUERY',\n  PROJECTS_TOTAL_USED = 'PROJECTS_TOTAL_USED',\n  PROJECTS_BY_USED = 'PROJECTS_BY_USED',\n  BUCKETS_TOTAL_USED = 'BUCKETS_TOTAL_USED',\n  BUCKETS_BY_USED = 'BUCKETS_BY_USED',\n  NOOBAA_USED = 'NOOBAA_USED',\n  NOOBAA_TOTAL = 'NOOBAA_TOTAL',\n  PROJECTS_OTHERS = 'PROJECTS_OTHERS',\n  BUCKETS_BY_OTHERS = 'BUCKETS_BY_OTHERS',\n  PROJECT_CAPACITY_USAGE_QUERY = 'PROJECT_CAPACITY_USAGE_QUERY',\n  BUCKET_CLASS_CAPACITY_USAGE_QUERY = 'BUCKET_CLASS_CAPACITY_USAGE_QUERY',\n  PROJECTS_QUERY = 'PROJECTS_QUERY',\n  BUCKETS_QUERY = 'BUCKETS_QUERY',\n}\n\nexport enum DATA_RESILIENCE_QUERIES {\n  REBUILD_PROGRESS_QUERY = 'NooBaa_rebuild_progress/100',\n  REBUILD_TIME_QUERY = 'NooBaa_rebuild_time',\n}\n\nexport enum ObjectDataReductionQueries {\n  EFFICIENCY_QUERY = 'NooBaa_reduction_ratio',\n  SAVINGS_QUERY = '(NooBaa_object_savings_logical_size - NooBaa_object_savings_physical_size)',\n  LOGICAL_SAVINGS_QUERY = 'NooBaa_object_savings_logical_size',\n}\n\nexport enum StatusCardQueries {\n  BUCKETS_COUNT = 'NooBaa_num_buckets',\n  UNHEALTHY_BUCKETS = 'NooBaa_num_unhealthy_buckets',\n  POOLS_COUNT = 'NooBaa_num_pools',\n  UNHEALTHY_POOLS = 'NooBaa_num_unhealthy_pools',\n}\n\nexport const CAPACITY_BREAKDOWN_QUERIES = {\n  [ObjectDashboardQuery.PROJECTS_BY_USED]: 'NooBaa_projects_capacity_usage',\n  [ObjectDashboardQuery.BUCKETS_BY_USED]: 'NooBaa_bucket_class_capacity_usage',\n};\n\nexport const breakdownQueryMap = {\n  [PROJECTS]: {\n    model: ProjectModel,\n    metric: 'project',\n    queries: {\n      [ObjectDashboardQuery.PROJECTS_BY_USED]: `sort_desc(topk(5, ${\n        CAPACITY_BREAKDOWN_QUERIES[ObjectDashboardQuery.PROJECTS_BY_USED]\n      }))`,\n      [ObjectDashboardQuery.PROJECTS_TOTAL_USED]: `sum(${\n        CAPACITY_BREAKDOWN_QUERIES[ObjectDashboardQuery.PROJECTS_BY_USED]\n      })`,\n    },\n  },\n  [BUCKET_CLASS]: {\n    model: NooBaaBucketClassModel,\n    metric: 'bucket_class',\n    queries: {\n      [ObjectDashboardQuery.BUCKETS_BY_USED]: `sort_desc(topk(5, ${\n        CAPACITY_BREAKDOWN_QUERIES[ObjectDashboardQuery.BUCKETS_BY_USED]\n      }))`,\n      [ObjectDashboardQuery.BUCKETS_TOTAL_USED]: `sum(${\n        CAPACITY_BREAKDOWN_QUERIES[ObjectDashboardQuery.BUCKETS_BY_USED]\n      })`,\n    },\n  },\n};\n"],"mappings":";;;;;;;;;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAKA;AAIA;AACA;AACA;AAKA;AAEA;AAEA;;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAIA;AACA;AAEA;AAMA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAMA;;;;;;;;;;;;;AC5HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAGA;AACA;AACA;;;;;A","sourceRoot":""}