{"version":3,"file":"alert-routing-modal-e0c3be83104784db6942.js","sources":["webpack:///./public/components/modals/alert-routing-modal.tsx"],"sourcesContent":["import * as React from 'react';\nimport * as _ from 'lodash-es';\n\nimport { createModalLauncher, ModalTitle, ModalBody, ModalSubmitFooter } from '../factory/modal';\nimport { K8sResourceKind } from '../../module/k8s';\nimport { AlertmanagerConfig } from '../monitoring/alert-manager-config';\nimport { patchAlertmanagerConfig } from '../monitoring/alert-manager-utils';\n\nconst updateAlertRoutingProperty = (\n  config: any,\n  propertyName: string,\n  newValue: string,\n  oldValue: string,\n) => {\n  if (!_.isEqual(newValue, oldValue)) {\n    if (_.isEmpty(newValue)) {\n      _.unset(config, ['route', propertyName]); // unset so global/default value will be used\n    } else {\n      _.set(config, ['route', propertyName], newValue);\n    }\n  }\n};\n\nexport const AlertRoutingModal: React.FC<AlertRoutingModalProps> = ({\n  config,\n  secret,\n  cancel,\n  close,\n}) => {\n  const [errorMessage, setErrorMessage] = React.useState();\n  const [inProgress, setInProgress] = React.useState(false);\n\n  const submit = (event): void => {\n    event.preventDefault();\n\n    let groupByNew = event.target.elements['input-group-by'].value.replace(/\\s+/g, '');\n    const groupWaitNew = event.target.elements['input-group-wait'].value;\n    const groupIntervalNew = event.target.elements['input-group-interval'].value;\n    const repeatIntervalNew = event.target.elements['input-repeat-interval'].value;\n\n    const groupByOld = _.get(config, ['route', 'group_by'], []);\n    const groupWaitOld = _.get(config, ['route', 'group_wait'], '');\n    const groupIntervalOld = _.get(config, ['route', 'group_interval'], '');\n    const repeatIntervalOld = _.get(config, ['route', 'repeat_interval'], '');\n\n    groupByNew = groupByNew === '' ? [] : groupByNew.split(',');\n    updateAlertRoutingProperty(config, 'group_by', groupByNew, groupByOld);\n    updateAlertRoutingProperty(config, 'group_wait', groupWaitNew, groupWaitOld);\n    updateAlertRoutingProperty(config, 'group_interval', groupIntervalNew, groupIntervalOld);\n    updateAlertRoutingProperty(config, 'repeat_interval', repeatIntervalNew, repeatIntervalOld);\n\n    setInProgress(true);\n    patchAlertmanagerConfig(secret, config).then(close, (err) => {\n      setErrorMessage(err.message);\n      setInProgress(false);\n    });\n  };\n\n  return (\n    <form onSubmit={submit} name=\"form\" className=\"modal-content\">\n      <ModalTitle className=\"modal-header\">Edit Routing Configuration</ModalTitle>\n      <ModalBody>\n        <div className=\"row co-m-form-row\">\n          <div className=\"col-sm-12\">\n            <label htmlFor=\"group-by\" className=\"control-label\">\n              Group By\n            </label>\n          </div>\n          <div className=\"co-m-form-col col-sm-12\">\n            <div className=\"form-inline\">\n              <div className=\"pf-c-input-group\">\n                <input\n                  placeholder=\"cluster, alertname\"\n                  type=\"text\"\n                  className=\"pf-c-form-control\"\n                  id=\"input-group-by\"\n                  data-test-id=\"input-group-by\"\n                  defaultValue={_.get(config, ['route', 'group_by'])}\n                  aria-describedby=\"input-group-by-help\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"row co-m-form-row\">\n          <div className=\"col-sm-12\">\n            <label htmlFor=\"group-wait\" className=\"control-label\">\n              Group Wait\n            </label>\n          </div>\n          <div className=\"co-m-form-col col-sm-12\">\n            <div className=\"form-inline\">\n              <div className=\"pf-c-input-group\">\n                <input\n                  placeholder=\"30s\"\n                  type=\"text\"\n                  className=\"pf-c-form-control\"\n                  id=\"input-group-wait\"\n                  data-test-id=\"input-group-wait\"\n                  defaultValue={_.get(config, ['route', 'group_wait'])}\n                  aria-describedby=\"input-group-wait-help\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"row co-m-form-row\">\n          <div className=\"col-sm-12\">\n            <label htmlFor=\"group-interval\" className=\"control-label\">\n              Group Interval\n            </label>\n          </div>\n          <div className=\"co-m-form-col col-sm-12\">\n            <div className=\"form-inline\">\n              <div className=\"pf-c-input-group\">\n                <input\n                  placeholder=\"5m\"\n                  type=\"text\"\n                  className=\"pf-c-form-control\"\n                  id=\"input-group-interval\"\n                  data-test-id=\"input-group-interval\"\n                  defaultValue={_.get(config, ['route', 'group_interval'])}\n                  aria-describedby=\"input-group-interval-help\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className=\"row co-m-form-row\">\n          <div className=\"col-sm-12\">\n            <label htmlFor=\"repeat-interval\" className=\"control-label\">\n              Repeat Interval\n            </label>\n          </div>\n          <div className=\"co-m-form-col col-sm-12\">\n            <div className=\"form-inline\">\n              <div className=\"pf-c-input-group\">\n                <input\n                  placeholder=\"3h\"\n                  type=\"text\"\n                  className=\"pf-c-form-control\"\n                  id=\"input-repeat-interval\"\n                  data-test-id=\"input-repeat-interval\"\n                  defaultValue={_.get(config, ['route', 'repeat_interval'])}\n                  aria-describedby=\"input-repeat-interval-help\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </ModalBody>\n      <ModalSubmitFooter\n        inProgress={inProgress}\n        errorMessage={errorMessage}\n        cancel={cancel}\n        submitText=\"Save\"\n      />\n    </form>\n  );\n};\n\nexport const createAlertRoutingModal = createModalLauncher<AlertRoutingModalProps>(\n  AlertRoutingModal,\n);\n\nexport type AlertRoutingModalProps = {\n  cancel: () => void;\n  close: () => void;\n  config: AlertmanagerConfig;\n  secret: K8sResourceKind;\n};\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAGA;AAEA;AAMA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAaA;AACA;AACA;AAIA;AACA;AACA;AACA;AAaA;AACA;AACA;AAIA;AACA;AACA;AACA;AAaA;AACA;AACA;AAIA;AACA;AACA;AACA;AAcA;AAQA;AAEA;;;;;A","sourceRoot":""}